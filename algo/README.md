## ACTIN-Algo

ACTIN-Algo matches a patient record (clinical & molecular data) with available treatments.

This application requires Java 11+ and can be run as follows:

```
java -cp actin.jar com.hartwig.actin.algo.TreatmentMatcherApplicationKt \
   -clinical_json /path/to/clinical.json \
   -molecular_json /path/to/molecular.json \
   -trial_database_directory /path/to/potential_trials \
   -doid_json /path/to/full_doid_tree_json_file \
   -atc_tsv /path/to/full_atc_tree_tsv_file \
   -output_directory /path/where/output/is/written \
```

The following assumptions are made about the inputs:

- The clinical JSON adheres to the datamodel defined by [ACTIN-Clinical](../clinical/README.md)
- The molecular JSON adheres to the datamodel defined by [ACTIN-Molecular](../molecular/README.md)
- The trial database directory is the output directory of [ACTIN-Trial](../trial/README.md)

An optional flag `run_historically` can be added in which case the treatment matcher sets the date to 3 weeks after the
patient's registration date. If this flag is not set, the treatment matcher uses the current date as reference date.

### Treatment matching

Every trial defined in the trial database is evaluated independently.

All relevant inclusion and exclusion criteria are evaluated for this trial as well as every criterion for any specific cohort within this
trial.

Every criterion evaluates to one of the following options:

| Evaluation      | Description                                                                                                                              |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------|
| PASS            | The patient complies with the inclusion or exclusion criterion.                                                                          |
| WARN            | The patient may or may not comply with inclusion or exclusion criterion. A manual evaluation is required.                                |
| FAIL            | The patient does not comply with the inclusion or exclusion criterion.                                                                   |
| UNDETERMINED    | The data that is required to evaluate the inclusion or exclusion criterion is unavailable.                                               |
| NOT_EVALUATED   | The evaluation of the inclusion or exclusion criterion is skipped and can be assumed to be irrelevant for determining trial eligibility. |

#### Recoverable status

Each criterion algorithm is configured as 'recoverable' or 'unrecoverable', indicating whether the outcome of the criterion evaluation
could potentially be recovered in case of a `FAIL`. For example, lab values may be insufficient at the moment of evaluation, leading
to `FAIL`, but may be sufficient 2 weeks later
when a new lab test has been done. Hence, lab rules can be 'recoverable', whereas a primary tumor location cannot change and primary tumor
location rules are thus 'unrecoverable'. Recoverability can be significant for non-`FAIL` results as well, for example a nested `PASS`
result that becomes a `FAIL` after negation with `NOT`.

Rules evaluating lab values and vital function/body weight measurements are all evaluated to `RECOVERABLE UNDETERMINED` when data is
missing.
This is done to reduce the amount of (less important) warnings on the report, since `RECOVERABLE UNDETERMINED` warnings are not shown.

#### Evaluation feedback

Every criterion algorithm provides human-readable feedback ('messages') about its evaluation, so that a human can easily and quickly
understand which evaluation has been done and why the outcome of the evaluation (`PASS`,`WARN`, `FAIL`, `UNDETERMINED` or `NOT_EVALUATED`)
is as it is.

#### Treatment eligibility

Once all criteria are evaluated, the following algorithm determines whether a patient is potentially eligible for a trial:

1. For every cohort within a trial, the patient is considered potentially eligible for that cohort in case none of the cohort-specific
   criteria evaluated to unrecoverable `FAIL`.
2. A patient is eligible for a trial in case none of its overall criteria evaluated to unrecoverable `FAIL` and the
   trial
   either has no cohorts defined or has at least one cohort that is considered potentially eligible.

Note that, following this logic, a patient is only considered potentially eligible for a cohort if both the cohort is considered eligible
_and_ the trial that the cohort is part of is considered eligible.

#### Criterion algorithms

Inclusion and exclusion criteria can be defined as a set of rules that are combined using composite functions, to determine overall
eligibility.

The following composite functions are available:

| Function | Description                                                                     |
|----------|---------------------------------------------------------------------------------|
| AND      | indicates that all combined rules should PASS in order to PASS                  |
| OR       | indicates that one of the combined rules should PASS in order to PASS           |
| NOT      | indicates that the rule should resolve to FAIL in order to PASS                 |
| WARN_IF  | indicates that the rule should resolve to WARN in case evaluation leads to PASS |

Some rules require 1 ("X") or more ("X" and "Y") additional configuration parameter(s) that can be set to match the requirements of each
trial.
Also, note that some inclusion and exclusion criteria can be mapped to rules that are currently explicitly set to PASS or explicitly
won't be evaluated.

The following rules are available:

##### Rules related to general characteristics / statements

| Rule                                     | When does a patient pass evaluation?         | Note                                                                                                                                             |
|------------------------------------------|----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| IS_AT_LEAST_X_YEARS_OLD                  | Current year minus birth year > X            | `UNDETERMINED` in case of exactly X                                                                                                              |
| IS_MALE                                  | Patient > Gender = Male                      |                                                                                                                                                  |
| IS_FEMALE                                | Patient > Gender = Female                    |                                                                                                                                                  |
| HAS_WHO_STATUS_OF_AT_MOST_X              | Patient > WHO <= X                           | Resolve to `WARN` in case patient WHO equals X+1 (e.g. if patient WHO = 2 and requested max WHO = 1). Note: WHO is the same as ECOG.             |
| HAS_WHO_STATUS_OF_AT_EXACTLY_X           | Patient > WHO = X                            | Resolve to `WARN` in case patient WHO equals X+1 or X-1 (e.g. if patient WHO = 2 or 0 and requested max WHO = 1). Note: WHO is the same as ECOG. |
| HAS_KARNOFSKY_SCORE_OF_AT_LEAST_X        | Patient > WHO in accordance with Karnofsky X | Resolve to `WARN` in case patient WHO equals Karnofsky X+1                                                                                       |
| HAS_LANSKY_SCORE_OF_AT_LEAST_X           | Patient > WHO in accordance with Lansky X    | Resolve to `WARN` in case patient WHO equals Lansky X+1                                                                                          |
| CAN_GIVE_ADEQUATE_INFORMED_CONSENT       | > Won't be evaluated                         |                                                                                                                                                  |
| HAS_LIFE_EXPECTANCY_OF_AT_LEAST_X_WEEKS  | > Won't be evaluated                         |                                                                                                                                                  |
| HAS_LIFE_EXPECTANCY_OF_AT_LEAST_X_MONTHS | > Won't be evaluated                         |                                                                                                                                                  |
| WILL_PARTICIPATE_IN_TRIAL_IN_COUNTRY_X   | > Currently set to the Netherlands           |                                                                                                                                                  |
| IS_LEGALLY_INSTITUTIONALIZED             | > Won't be evaluated                         |                                                                                                                                                  |
| IS_INVOLVED_IN_STUDY_PROCEDURES          | > Won't be evaluated                         |                                                                                                                                                  |
| USES_TOBACCO_PRODUCTS                    | Resolves to `UNDETERMINED`                   |                                                                                                                                                  |

##### Rules related to tumor and lesion localization

| Rule                                                                          | When does a patient pass evaluation?                                                                                                                                                                                                                                                                                                                                                                        | Note                                                                                                                                                                                                                                                                                                                                    |
|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_SOLID_PRIMARY_TUMOR                                                       | All configured DOIDs equal or child of DOID 162 or DOID 0060072 (benign neoplasm), no DOID equal or child of DOID 1240, 712 or 4960.                                                                                                                                                                                                                                                                        | Resolve to `WARN` in case any DOID equal or child of DOID 2531 ("Hematologic cancer") (but does not resolve to `FAIL` already)                                                                                                                                                                                                          |
| HAS_SOLID_PRIMARY_TUMOR _INCLUDING_LYMPHOMA                                   | All configured DOIDs equal or child of DOID 162 or DOID 0060072 (benign neoplasm), no DOID equal or child of DOID 1240, 712 or 4960.                                                                                                                                                                                                                                                                        | Resolve to `WARN` in case any DOID equal or child of DOID 5772, 3282, 5621, 3664, 8683 (but does not resolve to `FAIL` already)                                                                                                                                                                                                         |
| HAS_PRIMARY_TUMOR_LOCATION _BELONGING_TO_ANY_DOID_TERM_X                      | Any configured DOID term should be equal of a child of DOID belonging to any term in X                                                                                                                                                                                                                                                                                                                      | In case a sample configured DOID is equal or child of the DOID of list of "Main cancer types" and is a parent of the requested DOID, the tumor type may actually be correct but the required details were missing in the clinical data. Therefore, in these situations, resolve to `UNDETERMINED`                                       |
| HAS_PRIMARY_TUMOR_LOCATION _BELONGING_TO_ANY_DOID_TERM_X _DISTAL_SUB_LOCATION | Any configured DOID term should be equal of a child of DOID belonging to any term in X with tumor sub-location like %distal%                                                                                                                                                                                                                                                                                | As in HAS_PRIMARY_TUMOR_LOCATION_BELONGING_TO_ANY_DOID_TERM_X, `UNDETERMINED` when matching a main cancer type with limited detail. Returns `WARN` when the tumor DOIDs match but the sub-location does not.                                                                                                                            |
| HAS_CANCER_OF_UNKNOWN_PRIMARY _AND_TYPE_X                                     | All configured DOIDs equal or child of DOID of tumor type X specified, and none of configured DOIDs should be equal or child of DOID 0050686, and sublocation = "CUP". Resolve to `WARN` in case sublocation != "CUP". Resolve to `UNDETERMINED` in case ALL configured DOIDs exactly equal to DOID 162 (with or without tumor sublocation being "CUP")                                                     | X can be one of: Carcinoma (DOID 305), Adenocarcinoma (DOID: 299), Squamous cell carcinoma (DOID: 1749), Melanoma (DOID: 1909)                                                                                                                                                                                                          |
| HAS_CANCER_WITH_NEUROENDOCRINE _COMPONENT                                     | Term of any configured DOIDs like '%neuroendocrine%', or a child of a DOID with term like %neuroendocrine%, or any configured DOID equal or child of DOID 169 or 1800, or primary tumor extra details like %neuroendocrine% or %NEC% or %NET%. Resolve to `UNDETERMINED` in case the tumor has a small cell component (according to rule below), or inactivation of at least 2 of 3 genes: TP53, PTEN, RB1. |                                                                                                                                                                                                                                                                                                                                         |
| HAS_CANCER_WITH_SMALL_CELL _COMPONENT                                         | Term of any configured DOIDs like '%small cell%', or a child of a DOID with term like %small cell%, or any configured DOID equal or child of DOID 0050685, or primary tumor extra details like %small cell% or %SCNEC%                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                         |
| HAS_KNOWN_SCLC_TRANSFORMATION                                                 | Resolves to `UNDETERMINED` if tumor type is NSCLC, and (1) extra details contains "small cell" or "mixed", or (2) any DOID equal to or child of any doid term in the DoidConstants.SMALL_CELL_LUNG_CANCER_DOIDS set, or (3) in case of RB1/P53 loss or MYC amp in molecular data.                                                                                                                           | `FAIL` in case DOID not equal to or child of LUNG_NON_SMALL_CELL_CARCINOMA_DOID.                                                                                                                                                                                                                                                        |
| HAS_NON_SQUAMOUS_NSCLC                                                        | In case any DOID belongs to 'Lung adenocarcinoma', 'Lung Large Cell Carcinoma' or 'Lung non-squamous non-small cell lung carcinoma'                                                                                                                                                                                                                                                                         | `UNDETERMINED` in case DOID not matching to squamous cell NSCLC DOIDs and can be potentially non-squamous NSCLC                                                                                                                                                                                                                         |
| HAS_BREAST_CANCER_RECEPTOR_X_POSITIVE                                         | Options for X are "ER", "PR", "HER2". Pass if X is positive based on either prior molecular tests or DOID terms 0060080, 0060077, or 0060075.                                                                                                                                                                                                                                                               | `UNDETERMINED` if X not present in prior molecular test and DOID terms, if positivity is inconsistent in prior molecular test and DOID data, and if target-receptor is HER2 and not positive based on DOIDS/IHC but (1) ERBB2 amp present OR (2) IHC-score 2+. `WARN` if target-receptor is ER/PR and IHC-score is 1-10% (low-positive) |
| HAS_OVARIAN_CANCER_WITH _MUCINOUS_COMPONENT                                   | Any configured DOID equal or child of DOID 6278, 7013, 3267, 3604, 3606, 6067, 6469 or 6898, or both DOIDs 3030 & 2394 configured.                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                         |
| HAS_OVARIAN_BORDERLINE_TUMOR                                                  | Any DOID equal or child of DOID 2394 and primary tumor (sub)type = "Borderline tumor" or "Borderline ovarian tumor"                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_STOMACH_UNDIFFERENTIATED _TUMOR                                           | Any DOID equal or child of DOID 10534 and primary tumor (sub)type like %Undifferentiated%                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                         |
| HAS_SECONDARY_GLIOBLASTOMA                                                    | Resolves to `WARN` in case any primary tumor DOID equal or child of DOID 3068                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                         |
| HAS_CYTOLOGICAL_DOCUMENTATION _OF_TUMOR_TYPE                                  | Won't be evaluated                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                         |
| HAS_HISTOLOGICAL_DOCUMENTATION _OF_TUMOR_TYPE                                 | Won't be evaluated                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                         |
| HAS_ANY_STAGE_X                                                               | Tumor details > stage should be one of X. X can be one of: I, II, III, IIIA, IIIB, IIIC, IV.                                                                                                                                                                                                                                                                                                                | Note: In case tumor stage is unknown, it is assumed to be stage IV in case of known liver, CNS, brain, lung and/or bone lesions, unless patient also has accompanying primary tumor DOID belonging to DOID 3571 (Liver cancer), 3620 (CNS cancer), 1319 (Brain cancer), 1324 (Lung cancer) or 184 (Bone cancer), respectively.          |
| HAS_LOCALLY_ADVANCED_CANCER                                                   | Tumor details > stage should be III                                                                                                                                                                                                                                                                                                                                                                         | `WARN` in case of stage II                                                                                                                                                                                                                                                                                                              |
| HAS_METASTATIC_CANCER                                                         | Tumor details > stage should be III/IV                                                                                                                                                                                                                                                                                                                                                                      | `WARN` in case of brain cancer / head and neck cancer stage II                                                                                                                                                                                                                                                                          |
| HAS_UNRESECTABLE_CANCER                                                       | Tumor details > stage should be IV                                                                                                                                                                                                                                                                                                                                                                          | `UNDETERMINED` in case of III(A/B/C/)                                                                                                                                                                                                                                                                                                   |
| HAS_UNRESECTABLE_STAGE_III_CANCER                                             | Tumor details > stage, `UNDETERMINED` in case of III(A/B/C/)                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                         |
| HAS_RECURRENT_CANCER                                                          | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_INCURABLE_CANCER                                                          | Tumor details > stage should be IV                                                                                                                                                                                                                                                                                                                                                                          | `UNDETERMINED` in case of III(A/B/C/)                                                                                                                                                                                                                                                                                                   |
| HAS_ANY_LESION                                                                | Tumor details > Either hasLiverLesion, hasCnsLesions, hasBrainLesions, hasBoneLesions, hasLymphNodeLesions or hasOtherLesions = 1                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                         |
| HAS_LIVER_METASTASES                                                          | Tumor details > hasLiverLesions = 1                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_LIVER_METASTASES_ONLY                                                     | Tumor details > hasLiverLesions = 1, while hasBoneLesions, hasBrainLesions, hasCnsLesions, hasLymphNodeLesions and hasLungLesions = 0 or missing, and otherLesions is empty                                                                                                                                                                                                                                 | `WARN` in case hasLiverLesions = 1 while all others are missing                                                                                                                                                                                                                                                                         |
| MEETS_SPECIFIC_CRITERIA_REGARDING_LIVER_METASTASES                            | Resolves to `UNDETERMINED` in case liver metastases present or unknown                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                         |
| HAS_KNOWN_CNS_METASTASES                                                      | Tumor details > hasCnsLesions = 1 or hasBrainLesions = 1                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                         |
| HAS_KNOWN_ACTIVE_CNS_METASTASES                                               | Tumor details > hasActiveCnsLesions = 1 or hasActiveBrainLesions = 1                                                                                                                                                                                                                                                                                                                                        | Resolve to `FAIL` rather than `UNDETERMINED` in case of information regarding active CNS or Brain metastases is missing, but when it is confirmed that there are no CNS and brain metastases. `UNDETERMINED` if CNS metastases in history but no information about active CNS metastases.                                               |
| HAS_KNOWN_BRAIN_METASTASES                                                    | Tumor details > hasBrainLesions = 1                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_KNOWN_ACTIVE_BRAIN_METASTASES                                             | Tumor details > hasActiveBrainLesions = 1                                                                                                                                                                                                                                                                                                                                                                   | Resolve to `FAIL` rather than `UNDETERMINED` in case of information regarding active brain metastases is missing, but when it is confirmed that there are no CNS and brain metastases. `UNDETERMINED` if brain metastases in history but no information about active brain metastases.                                                  |
| MEETS_SPECIFIC_CRITERIA_REGARDING_BRAIN_METASTASES                            | Resolves to `UNDETERMINED` in case brain metastases present, or CNS metastases present and brain metastases unknown                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_EXTRACRANIAL_METASTASES                                                   | Tumor details > has lesions other than (belonging to category) brain, or uncategorized lesion (or biopsy location) which is certainly extracranial based on (part) of location string. Resolves to `UNDETERMINED` when only CNS-metastases (can be spinal cord), data missing for one or more categorized lesion locations, or only uncategorized lesions with uncertainty if extracranial present.         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_BONE_METASTASES                                                           | Tumor details > hasBoneLesions = 1                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                         |
| HAS_BONE_METASTASES_ONLY                                                      | Tumor details > hasBoneLesions = 1, while hasLiverLesions, hasBrainLesions, hasCnsLesions, hasLymphNodeLesions and hasLungLesions = 0 or missing, and otherLesions is empty                                                                                                                                                                                                                                 | `WARN` in case hasBoneLesions = 1 while all others are missing                                                                                                                                                                                                                                                                          |
| HAS_LUNG_METASTASES                                                           | Tumor details > hasLungLesions = 1                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                         |
| HAS_LYMPH_NODE_METASTASES                                                     | Tumor details > hasLymphNodeLesions = 1                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                         |
| HAS_VISCERAL_METASTASES                                                       | T.B.D.                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                         |
| HAS_UNRESECTABLE_PERITONEAL_METASTASES                                        | Resolves to `WARN` in case Tumor details > otherLesions contains 'peritoneal', 'peritoneum', 'intraperitoneal' or 'intraperitoneum'                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                         |
| HAS_LESIONS_CLOSE_TO_OR_INVOLVING_AIRWAY                                      | In case any DOID belongs to 'Bronchus cancer', 'Main bronchus cancer', 'Tracheal cancer', 'Lung hilum cancer'. Resolves to `WARN` in case Tumor details > hasLungLesions or any DOID belongs to 'lung cancer'                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                         |
| HAS_EXTENSIVE_SYSTEMIC_METASTASES_PREDOMINANTLY_DETERMINING_PROGNOSIS         | Resolves to `UNDETERMINED` in case of metastatic cancer                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                         |
| HAS_BIOPSY_AMENABLE_LESION                                                    | Presence of WGS (to be extended)                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                         |
| HAS_IRRADIATION_AMENABLE_LESION                                               | Resolves to `UNDETERMINED` in case of metastatic cancer                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                         |
| HAS_PRESENCE_OF_LESIONS _IN_AT_LEAST_X_SITES                                  | Number of all categorized lesion sites (Tumor details > has...) plus 1 if there are uncategorized lesions >= threshold                                                                                                                                                                                                                                                                                      | `UNDETERMINED` if maximum possible lesion sites based on uncategorized and biopsy location >= threshold > lesion site lower bound                                                                                                                                                                                                       |
| CAN_PROVIDE_FRESH_TISSUE _SAMPLE_FOR_FURTHER_ANALYSIS                         | Has biopsy amenable lesion (to be extended)                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                         |
| CAN_PROVIDE_ARCHIVAL_OR_FRESH _TISSUE_SAMPLE_FOR_FURTHER_ANALYSIS             | Has biopsy amenable lesion (to be extended)                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                         |
| MEETS_SPECIFIC_REQUIREMENTS _REGARDING_BIOPSY                                 | Resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                         |                                       
| HAS_EVALUABLE_DISEASE                                                         | Tumor details > hasMeasurableDisease = 1                                                                                                                                                                                                                                                                                                                                                                    | `UNDETERMINED` if no measurable disease or measurable disease unknown                                                                                                                                                                                                                                                                   |
| HAS_MEASURABLE_DISEASE                                                        | Tumor details > hasMeasurableDisease = 1                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                         |
| HAS_MEASURABLE_DISEASE_RECIST                                                 | Tumor details > hasMeasurableDisease = 1                                                                                                                                                                                                                                                                                                                                                                    | Resolve to `WARN` in case of tumor type equal or belonging to DOID 2531 (hematologic cancer), 1319 (brain  cancer), 0060058 (lymphoma), 9538 (multiple myeloma)                                                                                                                                                                         |
| HAS_MEASURABLE_DISEASE_RANO                                                   | Tumor details > hasMeasurableDisease = 1                                                                                                                                                                                                                                                                                                                                                                    | Resolve to `WARN` in case of tumor type not equal or belonging to DOID 3620 (central nervous system cancer)                                                                                                                                                                                                                             |
| HAS_PROGRESSIVE_DISEASE _ACCORDING_TO_SPECIFIC_CRITERIA                       | Resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                         |
| HAS_INJECTION_AMENABLE_LESION                                                 | Lesions or biopsyLocation like %subcutaneous% or %skin%, otherwise resolve to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                         |
| HAS_MRI_VOLUME_MEASUREMENT _AMENABLE_LESION                                   | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_EVIDENCE_OF_CNS_HEMORRHAGE _BY_MRI                                        | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_INTRATUMORAL_HEMORRHAGE_BY_MRI                                            | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_LOW_RISK_OF_HEMORRHAGE _UPON_TREATMENT                                    | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_SUPERSCAN_BONE_SCAN                                                       | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |
| HAS_BCLC_STAGE_X                                                              | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        | X can be one of: 0, A, B, C or D                                                                                                                                                                                                                                                                                                        |
| HAS_LEFT_SIDED_COLORECTAL_TUMOR                                               | Colorectal cancer with sub-location containing one of ("rectum", "descending colon", "colon sigmoid", "colon descendens", "rectosigmoid")                                                                                                                                                                                                                                                                   | Will `FAIL` for any right sub-locations in ("ascending colon", "colon ascendens", "caecum", "cecum", "transverse colon", "colon transversum", "flexura hepatica", "hepatic flexure") or if tumor DOID does not resolve to CRC, `UNDETERMINED` otherwise                                                                                 |
| HAS_SYMPTOMS_OF_PRIMARY_TUMOR_IN_SITU                                         | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                         |

##### Rules related to previous cancer treatments

| Rule                                                                                       | When does a patient pass evaluation?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Note                                                                                                                                                                                                                                       |
|--------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IS_NOT_ELIGIBLE_FOR_TREATMENT_WITH_CURATIVE_INTENT                                         | Currently resolves to `NOT_EVALUATED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_ON_LABEL_TREATMENT_X                                                       | For non-CRC patients resolves to `NOT_EVALUATED`, unless patient has had no previous treatments or tumor type CUP (`UNDETERMINED`). CRC patients are evaluated using CrcDecisionTree and will resolve to `UNDETERMINED` if patient is eligible for treatment X.                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_PALLIATIVE_RADIOTHERAPY                                                    | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_LOCO_REGIONAL_THERAPY                                                      | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_TREATMENT_LINES_X                                                          | Based on treatment history, patient is eligible to start treatment line in X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Checks if 1 is in X if patient has not had chemo or immunotherapy, 3 is in X if patient has had line 1 and targeted therapy, or 2 is in X otherwise.                                                                                       |
| IS_ELIGIBLE_FOR_LOCAL_LIVER_TREATMENT                                                      | Resolves to `UNDETERMINED` in case of liver lesions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Resolve to `WARN` in case of liver cancer with no liver lesions.                                                                                                                                                                           |
| IS_ELIGIBLE_FOR_INTENSIVE_TREATMENT                                                        | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_FIRST_LINE_PALLIATIVE_CHEMOTHERAPY                                         | Resolves to `UNDETERMINED` in case patient has metastatic cancer and no previous palliative chemotherapy                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                            |
| IS_ELIGIBLE_FOR_LOCAL_TREATMENT_OF_METASTASES                                              | Resolves to `UNDETERMINED` in case of metastatic cancer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                            |
| HAS_EXHAUSTED_SOC_TREATMENTS                                                               | For non-CRC, non-NSCLC patients, resolves to `NOT_EVALUATED` for patients with previous treatments or `UNDETERMINED` otherwise. CRC patients are evaluating using CrcDecisionTree and will `PASS` only if no required treatments remain. NSCLC patients: undetermined if treatment history contains platinum doublet chemotherapy, fail otherwise.                                                                                                                                                                                                           |                                                                                                                                                                                                                                            |
| HAS_HAD_AT_LEAST_X_APPROVED_TREATMENT_LINES                                                | Currently resolves to `UNDETERMINED`, unless there is no prior treatment history and X>0, then resolve to `FAIL`                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                            |
| HAS_HAD_AT_LEAST_X_SYSTEMIC_TREATMENT_LINES                                                | Treatment history > minimal nr of lines in case systemic = 1 => X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 'Minimal' refers to the number of non-interrupted distinct lines (by name). In case minimal nr of lines does not meet the requirements but maximal does, resolve to `UNDETERMINED`                                                         |
| HAS_HAD_AT_MOST_X_SYSTEMIC_TREATMENT_LINES                                                 | Treatment history > maximal nr of lines in case systemic = 1 <= X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 'Maximal' refers to the total number of lines. In case maximal nr of lines does not meet the requirements but minimal does, resolve to `UNDETERMINED`                                                                                      |
| HAS_HAD_ANY_CANCER_TREATMENT                                                               | Treatment history > not empty OR Medication > drug with category equal to <category>**                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                            |
| HAS_HAD_ANY_CANCER_TREATMENT_WITHIN_X_MONTHS                                               | Treatment history > any entry has stopdate after current date minus X months OR Medication > drug with category equal to <category>** and active X months prior to evaluation date                                                                                                                                                                                                                                                                                                                                                                           | Resolve to `WARN` if stopdate of any anti cancer treatment is within current date minus X months and current date minus X-1 months. Resolve to `UNDETERMINED` if stop date of any anti cancer therapy is unknown.                          |
| HAS_HAD_ANY_CANCER_TREATMENT_IGNORING_CATEGORY_X                                           | Treatment history > any entry with category other than X OR Medication > drug with category equal to <category>** other than X                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                            |
| HAS_HAD_TREATMENT_NAME_X                                                                   | Treatment history > contains entry with name or synonym of X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Resolve to `UNDETERMINED` when there's no match and the patient has trial treatments and any query treatment is from a category that may match trials.                                                                                     |
| HAS_HAD_TREATMENT_NAME_X_WITHIN_Y_WEEKS                                                    | Treatment history > contains entry with name or synonym of X occurring within Y weeks                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Evaluate stop year/month first, falling back to start year/month if null or `UNDETERMINED` where neither is available. Will `FAIL` when no treatments match query.                                                                         |
| HAS_HAD_FIRST_LINE_TREATMENT_NAME_X                                                        | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| HAS_HAD_DRUG_X_COMBINED_WITH_CATEGORY_Y_TREATMENT_OF_TYPES_Z                               | Patient has had drug X concurrently with drug of category Y according to 2] below with any of the types in Z                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                            |
| HAS_HAD_TREATMENT_WITH_ANY_DRUG_X                                                          | Treatment history > contains entry with therapy that includes a drug provided in list X OR Medication > drug equal to a drug provided in list X                                                                                                                                                                                                                                                                                                                                                                                                              | Resolve to `UNDETERMINED` when there's no match and the patient has trial treatments for which the drug is unknown, or if the patient has had a non-therapy trial for which the categories are unknown.                                    |
| HAS_HAD_TREATMENT_WITH_ANY_DRUG_X_AS_MOST_RECENT_LINE                                      | Treatment history > entry with most recent start date includes the drug provided in X                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                            |
| HAS_HAD_COMBINED_TREATMENT_NAMES_X_WITHIN_Y_WEEKS                                          | Treatment history > contains entries with names or synonyms of all X each occurring within Y weeks (currently resolves to `UNDETERMINED`)                                                                                                                                                                                                                                                                                                                                                                                                                    | Resolve to `WARN` in case Y => Y-2 , resolve to `UNDETERMINED` in case date cannot be evaluated                                                                                                                                            |
| HAS_HAD_COMBINED_TREATMENT_NAMES_X_AND_BETWEEN_Y_AND_Z_CYCLES                              | Treatment history > contains entries with names or synonyms of all X each with between Y and Z cycles                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Resolve to `UNDETERMINED` in case cycles cannot be evaluated                                                                                                                                                                               |
| HAS_HAD_CATEGORY_X_TREATMENT                                                               | Patient has had treatment OR Medication > drug of category X according to 1] below                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y                                                    | Patient has had treatment OR Medication > drug of category X according to 2] below, and corresponding type in Y                                                                                                                                                                                                                                                                                                                                                                                                                                              | Also see 'Notes' below                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                           
| HAS_HAD_CATEGORY_X_TREATMENT_OF_ALL_TYPES_Y                                                | Patient has had treatment OR Medication > drug of category X according to 2] below, and all corresponding types in Y                                                                                                                                                                                                                                                                                                                                                                                                                                         | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_FIRST_LINE_CATEGORY_X_OF_TYPES_Y_THERAPY                                           | Patient has had treatment of category X according to 2] below, and corresponding type in Y as first treatment line (currently resolves to `UNDETERMINED`)                                                                                                                                                                                                                                                                                                                                                                                                    | If a surgery is present and the line is the first line after surgery, resolve to `UNDETERMINED`                                                                                                                                            |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_WITHIN_Z_WEEKS                                     | Patient has had treatment of category X according to 2] below, and corresponding type in Y, with startDate within Z weeks OR Medication > drug with category equal to <category>* and active Y weeks prior to evaluation                                                                                                                                                                                                                                                                                                                                     | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Also see 'Notes' below                                                                                                                              |
| HAS_HAD_CATEGORY_X_TREATMENT_IGNORING_TYPES_Y                                              | Patient has had treatment OR Medication > drug of category X according to 2] below, and corresponding type not in Y                                                                                                                                                                                                                                                                                                                                                                                                                                          | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_IGNORING_TYPES_Y_WITHIN_Z_WEEKS                               | Patient has had treatment OR Medication > drug of category X according to 2] below, and corresponding type not in Y, with startDate within Z weeks                                                                                                                                                                                                                                                                                                                                                                                                           | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Also see 'Notes' below                                                                                                                              |
| HAS_HAD_CATEGORY_X_TREATMENT_IGNORING_DRUGS_Y                                              | Patient has had treatment OR Medication > drug of category X according to 2] below that does not include any drugs in Y                                                                                                                                                                                                                                                                                                                                                                                                                                      | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_IGNORING_DRUGS_Z                                   | Patient has had treatment OR Medication > drug of category X according to 2] below, and corresponding to any type in Y, excluding any drugs in Z                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                            |
| HAS_HAD_CATEGORY_X_TREATMENT_AND_AT_LEAST_Y_LINES                                          | Patient has had treatment of category X according to 1] below and number of lines => Y                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_AND_AT_MOST_Y_LINES                                           | Patient has had treatment of category X according to 1] below and number of lines <= Y                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_AND_AT_LEAST_Z_LINES                               | Patient has had treatment of category X according to 2] below, corresponding type in Y and number of lines => Z                                                                                                                                                                                                                                                                                                                                                                                                                                              | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_AND_AT_MOST_Z_LINES                                | Patient has had treatment of category X according to 2] below, corresponding type in Y and number of lines <= Z                                                                                                                                                                                                                                                                                                                                                                                                                                              | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_WITH_STOP_REASON_OTHER_THAN_PD                     | Patient has had treatment of category X according to 2] below, corresponding type in Y with stop reason anything other than PD.                                                                                                                                                                                                                                                                                                                                                                                                                              | `UNDETERMINED` if PD-status is unclear, or if history contains unclear trial treatment of correct category.                                                                                                                                |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPES_Y_FOR_AT_MOST_Z_WEEKS_WITH_STOP_REASON_OTHER_THAN_PD | Patient has had treatment of category X according to 2] below, corresponding type in Y and number of weeks <= Z with stop reason anything other than PD.                                                                                                                                                                                                                                                                                                                                                                                                     | `UNDETERMINED` if PD-status or number of weeks is unclear, or if history contains unclear trial treatment of correct category.                                                                                                             |
| HAS_HAD_CATEGORY_X_TREATMENT_OF_TYPE_Y_AS_MOST_RECENT_LINE                                 | Patient has received treatment of category X according to 2] below, and type Y as most recent treatment. Type input is optional, evaluates category only if type is null.                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                            |
| HAS_HAD_CATEGORY_X_TREATMENT_WITH_ANY_INTENT_Y                                             | Patient has had treatment of category X according to 2] below, with any intent Y                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Also see 'Notes' below                                                                                                                                                                                                                     |
| HAS_HAD_ADJUVANT_CATEGORY_X_TREATMENT                                                      | Patient has had treatment of category X according to 1] below with intent `ADJUVANT`                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          
| HAS_HAD_ADJUVANT_CATEGORY_X_TREATMENT_WITHIN_Y_WEEKS                                       | Patient has had treatment of category X according to 1] below with intent `ADJUVANT` and date within Y weeks                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                            |
| HAS_HAD_SYSTEMIC_THERAPY_WITH_ANY_INTENT_X                                                 | Patient has had treatment with any intent X, systemic = 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Resolves to `UNDETERMINED` if intent of systemic therapy unknown.                                                                                                                                                                          |      
| HAS_HAD_SYSTEMIC_THERAPY_WITH_ANY_INTENT_X_WITHIN_Y_WEEKS                                  | Patient has had treatment with any intent X, systemic = 1 and date within X weeks                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Resolves to `UNDETERMINED` if date or intent of systemic therapy unknown.                                                                                                                                                                  |                                                                                                                                                                                                                   
| HAS_RECEIVED_PLATINUM_BASED_DOUBLET                                                        | Treatment history > Platinum compound plus other chemotherapy within one treatment instance. A platinum doublet plus treatment of another category (e.g. immunotherapy) within one instance results in a `PASS`.                                                                                                                                                                                                                                                                                                                                             | `WARN` in case of platinum triplet (i.e. 3 chemotherapy drugs in one treatment instance of which at least one platinum compound), or above.                                                                                                |                                                                                                                                                                                                                   
| HAS_HAD_OBJECTIVE_CLINICAL_BENEFIT_FOLLOWING_NAME_X_TREATMENT                              | Treatment history contains treatment defined in X with partial or complete response as best response.                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Resolves to `WARN` in case best response is stable disease or mixed response. Resolves to `UNDETERMINED` if best response is null for treatment X.                                                                                         |
| HAS_HAD_OBJECTIVE_CLINICAL_BENEFIT_FOLLOWING_CATEGORY_X_TREATMENT                          | Treatment history contains treatment of category defined in X with partial or complete response as best response.                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                            |
| HAS_HAD_OBJECTIVE_CLINICAL_BENEFIT_FOLLOWING_CATEGORY_X_TREATMENT_OF_TYPES_Y               | Treatment history contains treatment of category defined in X and of any type defined in Y with partial or complete response as best response.                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                            |
| HAS_HAD_SOC_TARGETED_THERAPY_FOR_NSCLC                                                     | Treatment history contains treatment of category targeted therapy and any type or subtype of ALK-/EGFR-/MET-/RET-/ROS1-/TRK-/BRAF-inhibitor.                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                            |
| HAS_HAD_SOC_TARGETED_THERAPY_FOR_NSCLC_EXCLUDING_DRIVER_GENES_X                            | Treatment history contains treatment of category targeted therapy and any type or subtype of ALK-/EGFR-/MET-/RET-/ROS1-/TRK-/BRAF-inhibitor. All drug types targeting gene defined in X are ignored.                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| HAS_HAD_TARGETED_THERAPY_INTERFERING_WITH_RAS_MEK_MAPK_PATHWAY                             | Resolves to `PASS` if treatment history contains targeted therapy of drug types RAS-/RAF-/MEK-/ERK-inhibitor, `WARN` with drug types HER-, PDGFR-, FGFR-inhibitor, `UNDETERMINED` for trials with unknown or targeted therapy category and unknown type and to `FAIL` otherwise.                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                            |
| HAS_HAD_NON_INTERNAL_RADIOTHERAPY                                                          | Patient has had any treatment of category Radiotherapy and property isInternal is not true.                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                            |
| HAS_HAD_RADIOTHERAPY_TO_BODY_LOCATION_X                                                    | Treatment history > Treatment of type Radiotherapy and value in X matches (sub)string of any of the bodyLocation properties                                                                                                                                                                                                                                                                                                                                                                                                                                  | Resolves to `UNDETERMINED` if Radiotherapy treatment does not have a body location defined or String X does not match the body locations.                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_NAME_X_TREATMENT                                         | Treatment history > contains entry with name or synonym matching X and stop reason or best response of PD                                                                                                                                                                                                                                                                                                                                                                                                                                                    | In case PD cannot be determined, resolve to `UNDETERMINED`                                                                                                                                                                                 |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_CATEGORY_X_TREATMENT                                     | Patient has had treatment of category X according to 1] below. Stop reason or best response of any of these treatments is PD                                                                                                                                                                                                                                                                                                                                                                                                                                 | In case PD cannot be determined, resolve to `UNDETERMINED`                                                                                                                                                                                 |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_CATEGORY_X_TREATMENT_OF_TYPES_Y                          | Patient has had treatment of category X according to 2] below, and corresponding type in Y. Stop reason or best response of any of these treatments is PD                                                                                                                                                                                                                                                                                                                                                                                                    | In case PD cannot be determined, resolve to `UNDETERMINED`                                                                                                                                                                                 |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_CATEGORY_X_TREATMENT_OF_TYPES_Y_AND_AT_LEAST_Z_WEEKS     | Patient has had treatment of category X according to 2] below, and corresponding type in Y. Stop reason or best response of any of these treatments is PD and patient should have received the medication for at least Z weeks.                                                                                                                                                                                                                                                                                                                              | In case PD or duration cannot be determined, resolve to `UNDETERMINED`                                                                                                                                                                     |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_CATEGORY_X_TREATMENT_OF_TYPES_Y_AND_AT_LEAST_Z_CYCLES    | Patient has had treatment of category X according to 2] below, and corresponding type in Y. Stop reason or best response of any of these treatments is PD and patient should have had at least Z cycles.                                                                                                                                                                                                                                                                                                                                                     | In case PD or nr of cycles cannot be determined, resolve to `UNDETERMINED`                                                                                                                                                                 |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_AT_LEAST_X_TREATMENT_LINES                               | Treatment history > minimal nr of lines in case systemic = 1 => X, Stop reason or best response of latest treatment is PD, or stop year provided and PD can be assumed                                                                                                                                                                                                                                                                                                                                                                                       | In cases where latest treatment cannot be determined, stop reason is toxicity, or stop year not provided, resolve to `UNDETERMINED`                                                                                                        |
| HAS_PROGRESSIVE_DISEASE_FOLLOWING_TREATMENT_WITH_ANY_DRUG_X                                | Treatment history > contains entry with drug in X and stop reason or best response of PD                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | In case PD cannot be determined or a trial potentially matches, resolve to `UNDETERMINED`                                                                                                                                                  |
| HAS_ACQUIRED_RESISTANCE_TO_DRUG_X                                                          | Treatment history contains drug specified in X with stop reason or best response "Progressive disease"                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Resolves to `UNDETERMINED` if treatment history contains drug X but stop reason is toxicity or unknown/null.                                                                                                                               |
| HAS_RADIOLOGICAL_PROGRESSIVE_DISEASE_FOLLOWING_AT_LEAST_X_TREATMENT_LINES                  | Treatment history > minimal nr of lines in case systemic = 1 => X, Stop reason or best response of latest treatment is PD, or stop year provided and PD can be assumed (PD assumed to be radiological)                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                            |
| HAS_RADIOLOGICAL_PROGRESSIVE_DISEASE_AFTER_LATEST_TREATMENT_LINE                           | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| HAS_HAD_COMPLETE_RESECTION                                                                 | Treatment history > Treatment with name 'Complete resection'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `WARN` in case treatment with name like '%Resection%', `UNDETERMINED` In case treatment with name = 'Resection' or category = 'Surgery' without treatment name specified                                                                   |
| HAS_HAD_PARTIAL_RESECTION                                                                  | Treatment history > Treatment with name 'Partial resection'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `WARN` in case treatment with name like '%Resection%', `UNDETERMINED` In case treatment with name = 'Resection' or category = 'Surgery' without treatment name specified                                                                   |
| HAS_HAD_RESECTION_WITHIN_X_WEEKS                                                           | Treatment history > Treatment with name like '%resection%' and date within X weeks                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `UNDETERMINED` In case date unknown or category = 'Surgery' without treatment name specified. `WARN` if  Prior tumor treatments > Treatment with name like '%resection%' and date within last 2 weeks of X weeks                           |
| HAD_HAD_LIVER_RESECTION                                                                    | Treatment history > Treatment with category 'Surgery', name like '%resection%' and BodyLocationCategory 'LIVER'                                                                                                                                                                                                                                                                                                                                                                                                                                              | `UNDETERMINED` In case Treatment history > Treatment with category 'Surgery', name like '%resection%' and BodyLocationCategory is null or category = 'Surgery' with unspecified treatment name and BodyLocationCategory is null or 'LIVER' |
| HAS_HAD_LOCAL_HEPATIC_THERAPY_WITHIN_X_WEEKS                                               | Treatment history > Treatment with radioType like '%TACE%' or '%TARE%' and date within X weeks (currently resolves to `UNDETERMINED`)                                                                                                                                                                                                                                                                                                                                                                                                                        | `UNDETERMINED` In case of Radiotherapy treatment without type or date specified or                                                                                                                                                         |
| HAS_HAD_INTRATUMORAL_INJECTION_TREATMENT                                                   | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                            |
| HAS_CUMULATIVE_ANTHRACYCLINE_EXPOSURE_OF_AT_MOST_X_MG_PER_M2_DOXORUBICIN_OR_EQUIVALENT     | Resolve to `UNDETERMINED` in case patient has received Chemotherapy of type Anthracycline; or patient has cancer belonging to DOID terms "Breast cancer", "Lymph node cancer", "Sarcoma", "Ovarian cancer", "Multiple myeloma" or "Leukemia" AND "Chemotherapy" (without a type specified) in treatment history; or patient has had prior second primary belonging to DOID terms "Breast cancer", "Lymph node cancer", "Sarcoma", "Ovarian cancer", "Multiple myeloma" or "Leukemia" AND "Chemotherapy" in treatment history (or treatment history is empty) |                                                                                                                                                                                                                                            |
| HAS_PREVIOUSLY_PARTICIPATED_IN_TRIAL                                                       | Treatment history > Entry with isTrial set to true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                            |
| HAS_PREVIOUSLY_PARTICIPATED_IN_TRIAL_X                                                     | Treatment history > Entry with isTrial set to true and trialAcronym is equal to acronym X                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `UNDETERMINED` In case treatment category = 'Trial' without trialAcronym configured                                                                                                                                                        |
| IS_NOT_PARTICIPATING_IN_ANOTHER_TRIAL                                                      | Currently resolves to `NOT_EVALUATED`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                            |
| HAS_RECEIVED_POTENTIAL_SYSTEMIC_TREATMENT_FOR_BRAIN_METASTASES                             | `WARN` in case patient has brain/CNS metastases AND received systemic therapy. `FAIL` Otherwise.                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                            |
| HAS_HAD_BRAIN_RADIATION_THERAPY                                                            | Treatment history > Treatment with category 'Radiotherapy' and BodyLocationCategory 'BRAIN'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `UNDETERMINED` if treatment history contains treatment of category Radiotherapy and HasBrainLesions == true                                                                                                                                |                                  

1] A 'Category' can be one of: Chemotherapy, Hormone therapy, Immunotherapy, Targeted therapy, Radiotherapy, Surgery, Transplantation,
Trial,
Antiviral therapy, Vaccine, Car T, TCR T, Gene therapy, Supportive treatment. Categories are subdivided into many treatment types such as
anthracycline and brachytherapy, which can be matched by these rules as well.

2] 'Category' with specified 'types' can be only one of: Chemotherapy, Hormone therapy, Immunotherapy, Targeted therapy, Radiotherapy,
Transplantation, Trial, Car T, Supportive treatment. Multiple types can be specified within one rule, separated by ";".

Note that if the type of the requested category is not configured for a treatment, evaluation resolves to `UNDETERMINED`.

Finally, any trial that a patient has participated in counts as one potential treatment of any type or category.
Trials could lead to `WARN` in case knowing the exact trial treatment is required to do a conclusive evaluation.

##### Rules related to prior primary tumors

| Rule                                                                  | When does a patient pass evaluation?                                                                                                                     | Note                                                                                                                                                                                             |
|-----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_ACTIVE_SECOND_MALIGNANCY                                          | Prior second primary > any entry with active=1                                                                                                           |                                                                                                                                                                                                  |
| HAS_HISTORY_OF_SECOND_MALIGNANCY                                      | Prior second primary > any entry                                                                                                                         |                                                                                                                                                                                                  |
| HAS_HISTORY_OF_SECOND_MALIGNANCY_IGNORING_DOID_TERMS_X                | Prior second primary > any entry excluding entries with DOID term belonging to any in X                                                                  | 
| HAS_HISTORY_OF_SECOND_MALIGNANCY_BELONGING_TO_DOID_TERM_X             | Prior second primary > contains any entry with DOID belonging to DOID term X                                                                             |                                                                                                                                                                                                  |
| HAS_HISTORY_OF_SECOND_MALIGNANCY_WITHIN_X_YEARS                       | Prior second primary > current year (+month) - lastTreatmentYear (+month) should be <= X                                                                 | In case lastTreatmentYear is empty, but diagnosedYear is not, use diagnosedYear - but set X to X+1 to be certain to collect all cases. In case no dates are provided, resolve to `UNDETERMINED`. |
| HAS_HISTORY_OF_SECOND_MALIGNANCY_WITHIN_X_YEARS_IGNORING_DOID_TERMS_Y | Prior second primary > current year (+month) - lastTreatmentYear (+month) should be <= X for any prior with a DOID that does not belong to any term in Y | In case lastTreatmentYear is empty, but diagnosedYear is not, use diagnosedYear - but set X to X+1 to be certain to collect all cases. In case no dates are provided, resolve to `UNDETERMINED`. |

##### Rules related to molecular results

| Rule                                                                                  | When does a patient pass evaluation?                                                                                                                                                                                                                                                                               | Note                                                                                                                                                 |
|---------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| DRIVER_EVENT_IN_ANY_GENES_X_WITH_APPROVED_THERAPY_AVAILABLE                           | Evaluates for CRC and lung cancer patients whether patient has a molecular driver event in gene X for which SOC exists. For other cancer types resolves to `UNDETERMINED`.                                                                                                                                         |                                                                                                                                                      |
| HAS_MOLECULAR_EVENT_WITH_SOC_TARGETED_THERAPY_AVAILABLE_IN_NSCLC                      | Reportable activating variant in EGFR gene, specific variant EGFR L858R or BRAF V600E, insertion in EGFR 20, deletion in EGFR 19, fusion in ROS1/ALK/RET/NTRK, or METex14 skipping mutation. NB. This rule only evaluates molecular events, not if the available therapy was already administered in a prior line. |                                                                                                                                                      |
| HAS_MOLECULAR_EVENT_WITH_SOC_TARGETED_THERAPY_AVAILABLE_IN_NSCLC_EXCLUDING_ANY_GENE_X | Evaluates like HAS_MOLECULAR_EVENT_WITH_TARGETED_THERAPY_AVAILABLE_IN_NSCLC except gene in X is not evaluated. NB. This rule only evaluates molecular events, not if the available therapy was already administered in a prior line.                                                                               |                                                                                                                                                      |
| ACTIVATION_OR_AMPLIFICATION_OF_GENE_X                                                 | Conditions for activating mutation or amplification (below rules) are met                                                                                                                                                                                                                                          |                                                                                                                                                      |
| ACTIVATING_MUTATION_IN_ANY_GENES_X                                                    | If geneRole of any gene mentioned in X is not 'TSG' and a high driver variant matching with protein effect gain of function (predicted)                                                                                                                                                                            | `WARN` in case of gene role TSG, driver likelihood, other protein effect, hotspot statuses and/or unreportability                                    |
| ACTIVATING_MUTATION_IN_GENE_X_EXCLUDING_CODONS_Y                                      | If geneRole of gene X is not 'TSG' and a high driver variant matching with protein effect gain of function (predicted), and affected codon is not among Y                                                                                                                                                          | `WARN` in case of gene role TSG, driver likelihood, other protein effect, hotspot statuses and/or unreportability                                    | 
| AMPLIFICATION_OF_GENE_X                                                               | If geneRole of gene X is not 'TSG' and min copy nr > 3*ploidy and protein effect is not loss of function (predicted)                                                                                                                                                                                               | `WARN` in case of gene role TSG, partial amplification, other protein effect and/or unreportability                                                  |
| AMPLIFICATION_OF_GENE_X_OF_AT_LEAST_Y_COPIES                                          | If geneRole of gene X is not 'TSG' and min copy nr > Y and protein effect is not loss of function (predicted)                                                                                                                                                                                                      | `WARN` in case of gene role TSG, partial amplification, other protein effect, copy nr < Y and/or unreportability                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
| MUTATION_IN_GENE_X_OF_ANY_PROTEIN_IMPACTS_Y                                           | Variant with protein impact of any Y is present in gene X and reportable                                                                                                                                                                                                                                           | `WARN` in case of non-canonical transcript or unreportability                                                                                        |
| MUTATION_IN_GENE_X_IN_ANY_CODONS_Y                                                    | Variant in codon Y of gene X and reportable                                                                                                                                                                                                                                                                        | `WARN` in case of non-canonical transcript or unreportability                                                                                        |
| MUTATION_IN_GENE_X_IN_EXON_Y                                                          | Variant in exon Y of gene X and reportable                                                                                                                                                                                                                                                                         | `WARN` in case of non-canonical transcript or unreportability                                                                                        |
| MUTATION_IN_GENE_X_IN_EXON_Y_TO_EXON_Z                                                | Variant in codon Y-Z of gene X and reportable                                                                                                                                                                                                                                                                      | `WARN` in case of non-canonical transcript or unreportability                                                                                        |
| MUTATION_IN_GENE_X_IN_EXON_Y_OF_TYPE_Z                                                | Variant in exon Y of type Z (one of: INSERT, INDEL, DELETE, SNV, MNV) in gene X and reportable                                                                                                                                                                                                                     | `WARN` in case of non-canonical transcript or unreportability                                                                                        |
| INACTIVATION_OF_GENE_X                                                                | If geneRole of gene X is not 'ONCO', and (min copy nr < 0.5 or homozygous disruption or biallelic mutation(s) with high driver likelihood, and corresponding event does not match with protein effect gain of function (predicted)                                                                                 | `WARN` in case of gene role ONCO, driver likelihood, other protein effect, biallelic status and/or reportability                                     |
| UTR_3_LOSS_IN_GENE_X                                                                  | Reportable hotspot variant in 3' UTR region is present in gene X                                                                                                                                                                                                                                                   | `WARN` in case of other variants in 3'UTR region, disruption in 3'UTR region or unreportability                                                      |
| FUSION_IN_GENE_X                                                                      | Reportable fusion based on driver type in combination with gene X with high driver likelihood is found                                                                                                                                                                                                             | `WARN` in case of fusion with low driver likelihood, protein effect 'no effect' or unreportability                                                   |
| WILDTYPE_OF_GENE_X                                                                    | No reportable variant, loss, (homozygous) disruption or fusion is detected (if geneRole is not ONCO); No reportable variant, amplification or fusion is detected (if geneRole is not TSG)                                                                                                                          | `WARN` in case of event is associated with protein effect 'No effect' or if event might still be considered wild-type (amplification or loss)        |
| EXON_SKIPPING_GENE_X_EXON_Y                                                           | Intra-gene fusion in gene X leading to skipping of exon Y. This rule passes only when the exact, specific exon is skipped and not a range that includes the exon.                                                                                                                                                  | `WARN` in case of reportable splice variant in splice region of exon Y of gene X                                                                     |
| MSI_SIGNATURE                                                                         | MS Status = MSI + at least one reportable biallelic driver in MSI genes detected                                                                                                                                                                                                                                   | `WARN` in case of MSI signature without any (biallelic) driver in MSI genes detected                                                                 |
| HRD_SIGNATURE                                                                         | HR Status = HRD + at least one reportable biallelic driver in HR genes detected                                                                                                                                                                                                                                    | `WARN` in case of HRD signature without any (biallelic) driver in HRD genes detected                                                                 |
| HRD_SIGNATURE_WITHOUT_MUTATION_OR_WITH_VUS_MUTATION_IN_GENES_X                        | HRD signature with no variants in any gene X, with a non-homozygous disruption in any gene X OR with a homozygous disruption in any gene X                                                                                                                                                                         | `WARN` in case of HRD signature without any (biallelic) driver in HRD genes detected OR in case HRD signature with non-hotspot variant in any gene X |
| HRD_SIGNATURE_WITHOUT_MUTATION_IN_GENES_X                                             | HRD signature with no variants in any gene X                                                                                                                                                                                                                                                                       | `WARN` in case of HRD signature without any (biallelic) driver in HRD genes detected                                                                 |
| TMB_OF_AT_LEAST_X                                                                     | Tumor Mutational Burden (TMB) should be => X                                                                                                                                                                                                                                                                       | `WARN` in case of low purity and TMB => X-0.5                                                                                                        |
| TML_OF_AT_LEAST_X                                                                     | Tumor Mutational Load (TML) should be => X                                                                                                                                                                                                                                                                         | `WARN` in case of low purity and TML => X-5                                                                                                          |
| TML_BETWEEN_X_AND_Y                                                                   | TML should be between X and Y                                                                                                                                                                                                                                                                                      | `WARN` in case of low purity and TML => X-5                                                                                                          |
| HAS_HLA_TYPE_X                                                                        | HLA type should be type X, no somatic mutations or loss of corresponding allele in tumor                                                                                                                                                                                                                           | `WARN` in case of somatic mutations or loss of allele                                                                                                |
| HAS_UGT1A1_HAPLOTYPE_X                                                                | UGT1A1 haplotype should be type X                                                                                                                                                                                                                                                                                  |                                                                                                                                                      |
| HAS_HOMOZYGOUS_DPYD_DEFICIENCY                                                        | DPYD haplotype is %_HOM% and function is not equal to "Normal function" OR both %_HET% DPYD haplotypes have function not equal to "Normal function"                                                                                                                                                                |                                                                                                                                                      |
| HAS_HETEROZYGOUS_DPYD_DEFICIENCY                                                      | One %_HET% DPYD haplotype has function not equal to "Normal function" and other %_HET% haplotype has function equal to "Normal function"                                                                                                                                                                           |                                                                                                                                                      |
| HAS_KNOWN_HPV_STATUS                                                                  | WGS contains tumor cells and/or HPV in prior molecular tests impliesPotentialIndeterminateStatus = 0                                                                                                                                                                                                               |                                                                                                                                                      |
| OVEREXPRESSION_OF_GENE_X                                                              | Currently set to `UNDETERMINED` (to be supported)                                                                                                                                                                                                                                                                  |                                                                                                                                                      |
| NON_EXPRESSION_OF_GENE_X                                                              | Currently set to `UNDETERMINED` (to be supported)                                                                                                                                                                                                                                                                  |                                                                                                                                                      |
| SPECIFIC_MRNA_EXPRESSION_REQUIREMENTS_MET_FOR_GENES_X                                 | Currently set to `UNDETERMINED`                                                                                                                                                                                                                                                                                    |                                                                                                                                                      |
| EXPRESSION_OF_PROTEIN_X_BY_IHC                                                        | Prior molecular test > Test = IHC, Item = X and (scoreText = positive or scoreValue>0)                                                                                                                                                                                                                             |                                                                                                                                                      |
| EXPRESSION_OF_PROTEIN_X_BY_IHC_OF_EXACTLY_Y                                           | Prior molecular test > Test = IHC, Item = X and scoreValue = Y                                                                                                                                                                                                                                                     | In case scoreText = "positive" or "negative", resolve to `UNDETERMINED`                                                                              |
| EXPRESSION_OF_PROTEIN_X_BY_IHC_OF_AT_LEAST_Y                                          | Prior molecular test > Test = IHC, Item = X and scoreValue >= Y                                                                                                                                                                                                                                                    | In case scoreText = "positive" or "negative", resolve to `UNDETERMINED`                                                                              |
| EXPRESSION_OF_PROTEIN_X_BY_IHC_OF_AT_MOST_Y                                           | Prior molecular test > Test = IHC, Item = X and scoreValue <= Y                                                                                                                                                                                                                                                    | In case scoreText = "positive" or "negative", resolve to `UNDETERMINED`                                                                              |
| PROTEIN_X_IS_WILD_TYPE_BY_IHC                                                         | Prior molecular test > Test = IHC, Item = X and scoreText case-insensitively matches "wildtype", "wild-type", or "wild type"                                                                                                                                                                                       | Any other result (including no matching prior tests) resolves to `UNDETERMINED`                                                                      |
| HER2_STATUS_IS_POSITIVE                                                               | Prior molecular test > Test = IHC, Item = HER2 and (scoreValue >= 3 or scoreText = positive)                                                                                                                                                                                                                       | `WARN` if IHC test result conflicts with ERBB2 AMP or conflicting IHC results. `UNDETERMINED` if no (reliable) HER2 IHC test result available.       | 
| PD_L1_SCORE_OF_AT_LEAST_X                                                             | Prior molecular test > Test = IHC, Item = PD-L1, measure = any type, scoreValue => X                                                                                                                                                                                                                               |                                                                                                                                                      |
| PD_L1_SCORE_OF_AT_MOST_X                                                              | Prior molecular test > Test = IHC, Item = PD-L1, measure = any type, scoreValue <= X                                                                                                                                                                                                                               |                                                                                                                                                      |
| PD_L1_SCORE_CPS_OF_AT_LEAST_X                                                         | Prior molecular test > Test = IHC, Item = PD-L1, measure = CPS, scoreValue => X                                                                                                                                                                                                                                    |                                                                                                                                                      |
| PD_L1_SCORE_CPS_OF_AT_MOST_X                                                          | Prior molecular test > Test = IHC, Item = PD-L1, measure = CPS, scoreValue <= X                                                                                                                                                                                                                                    |                                                                                                                                                      |
| PD_L1_SCORE_TPS_OF_AT_MOST_X                                                          | Prior molecular test > Test = IHC, Item = PD-L1, measure = TPS (in %), scoreValue <= X                                                                                                                                                                                                                             |                                                                                                                                                      |
| PD_L1_SCORE_TAP_OF_AT_MOST_X                                                          | Prior molecular test > Test = IHC, Item = PD-L1, measure = TAP (in %), scoreValue <= X                                                                                                                                                                                                                             |                                                                                                                                                      |
| PD_L1_SCORE_TPS_OF_AT_LEAST_X                                                         | Prior molecular test > Test = IHC, Item = PD-L1, measure = TPS (in %), scoreValue >= X                                                                                                                                                                                                                             |                                                                                                                                                      |
| PD_L1_SCORE_IC_OF_AT_LEAST_X                                                          | Prior molecular test > Test = IHC, Item = PD-L1, measure = IC (in %), scoreValue >= X                                                                                                                                                                                                                              |                                                                                                                                                      |
| PD_L1_SCORE_TC_OF_AT_LEAST_X                                                          | Prior molecular test > Test = IHC, Item = PD-L1, measure = TC (in %), scoreValue >= X                                                                                                                                                                                                                              |                                                                                                                                                      |
| PD_L1_SCORE_TAP_OF_AT_LEAST_X                                                         | Prior molecular test > Test = IHC, Item = PD-L1, measure = TAP (in %), scoreValue >= X                                                                                                                                                                                                                             |                                                                                                                                                      |
| PD_L1_STATUS_MUST_BE_AVAILABLE                                                        | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                               |                                                                                                                                                      |
| HAS_PSMA_POSITIVE_PET_SCAN                                                            | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                               |                                                                                                                                                      |
| MOLECULAR_RESULTS_MUST_BE_AVAILABLE                                                   | Resolves to `NOT_EVALUATED`                                                                                                                                                                                                                                                                                        |                                                                                                                                                      |
| MOLECULAR_TEST_MUST_HAVE_BEEN_DONE _FOR_GENE_X                                        | Ingestion of molecular results with experiment type 'WGS' or presence of previous molecular test for gene X                                                                                                                                                                                                        | Resolve to recoverable `FAIL` in case results not present, resolve to `UNDETERMINED` in case impliesPotentialIndeterminateStatus=1                   |
| MOLECULAR_TEST_MUST_HAVE_BEEN_DONE _FOR_PROMOTER_OF_GENE_X                            | Previous molecular test for gene X and item contains %promoter%                                                                                                                                                                                                                                                    | Resolve to recoverable `FAIL` in case results not present, resolve to `UNDETERMINED` in case impliesPotentialIndeterminateStatus=1                   |
| MMR_STATUS_IS_AVAILABLE                                                               | MMR status is available                                                                                                                                                                                                                                                                                            |                                                                                                                                                      |
| HAS_KNOWN_NSCLC_DRIVER_GENE_STATUSES                                                  | Molecular history contains WGS or OncoPanel with containsTumorCells == true OR all genes from the following list are covered in other panels: EGFR, MET, BRAF, ALK, ROS1, RET, NTRK1, NTRK2, NTRK3.                                                                                                                | Resolves to `UNDETERMINED` if WGS or OncoPanel with containsTumorCells == false AND genes not covered in other panels.                               | 
| HAS_EGFR_PACC_MUTATION                                                                | Variant in of the following codons of the EGFR gene (according to Robichaux et al. Structure-based classification predicts drug response in EGFR): G719, S768, L747, V769, E709, C797, L792, G724, L718, T854                                                                                                      |                                                                                                                                                      | 
| HAS_CODELETION_OF_CHROMOSOME_ARMS_X_AND_Y                                             | Currently resolves to `UNDETERMINED`                                                                                                                                                                                                                                                                               |                                                                                                                                                      |

##### Rules related to recent laboratory measurements

_Blood components / blood cell components_

| Rule                                        | When does a patient pass evaluation?                                                   | Note                                                                                                             |
|---------------------------------------------|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| HAS_LEUKOCYTES_ABS_OF_AT_LEAST_X            | Leukocytes absolute (LEUKO-ABS) in 10^9/L => X                                         |                                                                                                                  |
| HAS_LEUKOCYTES_ABS_LLN_OF_AT_LEAST_X        | Leukocytes absolute (LEUKO-ABS) in 10^9/L => X*LLN                                     |                                                                                                                  |
| HAS_LYMPHOCYTES_ABS_OF_AT_LEAST_X           | Lymphocytes absolute (LYMPHO-ABS-eDA/LYMPHO-ABS-eDM) in 10*9/L => X                    |                                                                                                                  |
| HAS_LYMPHOCYTES_CELLS_PER_MM3_OF_AT_LEAST_X | Lymphocytes in cells per mm3 => X                                                      | In case lymphocytes is measured in 10\*9/L, the value is converted using Lympho[cells/mm3]=Lympho[10\*9/L]/0.001 |
| HAS_NEUTROPHILS_ABS_OF_AT_LEAST_X           | Neutrophil granulocytes absolute (NEUTRO-ABS/NEUTRO-ABS-eDA) in 10^9/L or 10\*9/L => X |                                                                                                                  |
| HAS_THROMBOCYTES_ABS_OF_AT_LEAST_X          | Thrombocytes absolute (THROMBO-ABS) in 10*9/L => X                                     |                                                                                                                  |
| HAS_HEMOGLOBIN_G_PER_DL_OF_AT_LEAST_X       | Hemoglobin (Hb) in g/dL => X.                                                          | In case Hb is measured in mmol/L, the value is converted to g/dL using Hb[g/dL]=Hb[mmol/L]/0.6206                |
| HAS_HEMOGLOBIN_MMOL_PER_L_OF_AT_LEAST_X     | Hemoglobin (Hb) in mmol/L => X.                                                        | In case Hb is measured in g/dL, the value is converted to mmol/L using Hb[mmol/L]=Hb[g/dL]*0.6206                |
| HAS_POTENTIAL_LEUKOCYTOSIS                  | Leukocytes absolute (LEUKO-ABS) in 10^9/L => ULN                                       |                                                                                                                  |

_Blood clotting factors_

| Rule                                        | When does a patient pass evaluation?                   | Note |
|---------------------------------------------|--------------------------------------------------------|------|
| HAS_INR_ULN_OF_AT_MOST_X                    | International normalized ratio (INR/POCT_INR) <= X*ULN |      |
| HAS_PT_ULN_OF_AT_MOST_X                     | Prothrombin time (PT/POCT_PT) <= X*ULN                 |      |
| HAS_PT_WITHIN_INSTITUTIONAL_NORMAL_LIMITS   | Prothrombin time (PT) LLN<X<ULN                        |      |
| HAS_APTT_ULN_OF_AT_MOST_X                   | Activated partial thromboplastin time (APTT) <= X*ULN  |      |
| HAS_APTT_WITHIN_INSTITUTIONAL_NORMAL_LIMITS | Activated partial thromboplastin time (APTT) LLN<X<ULN |      |
| HAS_PTT_ULN_OF_AT_MOST_X                    | T.B.D.                                                 |      |

_Liver function_

| Rule                                                                          | When does a patient pass evaluation?                         | Note                                                                                |
|-------------------------------------------------------------------------------|--------------------------------------------------------------|-------------------------------------------------------------------------------------|
| HAS_ALBUMIN_G_PER_DL_OF_AT_LEAST_X                                            | Albumin (ALB) in g/dL => X.                                  | In case ALB is measured in g/L, the value is converted using ALB[g/dL]=ALB[g/L]/10. |
| HAS_ALBUMIN_LLN_OF_AT_LEAST_X                                                 | Albumin (ALB) > X*ULN                                        |                                                                                     |
| HAS_ASAT_ULN_OF_AT_MOST_X                                                     | Aspartate aminotransferase (ASAT) <= X*ULN                   |                                                                                     |
| HAS_ALAT_ULN_OF_AT_MOST_X                                                     | Alanine aminotransferase (ALAT) <= X*ULN                     |                                                                                     |
| HAS_ASAT_AND_ALAT_ULN_OF_AT_MOST_X_OR_AT_MOST_Y_WHEN_LIVER_METASTASES_PRESENT | ALAT + ASAT <= X*ULN or <= Y*ULN if liver metastases present |                                                                                     |
| HAS_ALP_ULN_OF_AT_MOST_X                                                      | Alkaline phosphatase (ALP) <= X*ULN                          |                                                                                     |
| HAS_ALP_ULN_OF_AT_LEAST_X                                                     | Alkaline phosphatase (ALP) => X*ULN                          |                                                                                     |
| HAS_TOTAL_BILIRUBIN_ULN_OF_AT_MOST_X                                          | Total Bilirubin (TBIL) <= X*ULN                              |                                                                                     |
| HAS_TOTAL_BILIRUBIN_UMOL_PER_L_OF_AT_MOST_X                                   | Total Bilirubin (TBIL) in umol/L <= X                        |                                                                                     |
| HAS_DIRECT_BILIRUBIN_ULN_OF_AT_MOST_X                                         | Direct Bilirubin (DBIL) <= X*ULN                             | Direct Bilirubin = Conjugated bilirubin                                             |
| HAS_DIRECT_BILIRUBIN_PERCENTAGE_OF_TOTAL_OF_AT_MOST_X                         | Direct Bilirubin (DBIL) / Total Bilirubin (TBIL) * 100 <= X  |                                                                                     |
| HAS_INDIRECT_BILIRUBIN_ULN_OF_AT_MOST_X                                       | Total bilirubin (TBIL) - Direct Bilirubin (DBIL) <= X*ULN    | Indirect Bilirubin = Unconjugated bilirubin                                         |

_Kidney function_

| Rule                                            | When does a patient pass evaluation?                            | Note                                                                                            |
|-------------------------------------------------|-----------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| HAS_CREATININE_MG_PER_DL_OF_AT_MOST_X           | Creatinine (CREA) in mg/dL <= X                                 | In case CREA is measured in umol/l, the value is converted using CREA[mg/dL]=CREA[umol/l]/88.42 |
| HAS_CREATININE_ULN_OF_AT_MOST_X                 | Creatinine (CREA) <= X*ULN                                      |                                                                                                 |
| HAS_EGFR_CKD_EPI_OF_AT_LEAST_X                  | eGFR (CKD-EPI formula) => X.                                    | In case CrCl is measured in another unit, the value is converted                                |
| HAS_EGFR_MDRD_OF_AT_LEAST_X                     | eGFR (MDRD formula) => X.                                       | In case CrCl is measured in another unit, the value is converted                                |
| HAS_CREATININE_CLEARANCE_CG_OF_AT_LEAST_X       | Creatinine clearance (Cockcroft Gault formula) => X.            | In case CrCl is measured in another unit, the value is converted                                |
| HAS_CREATININE_CLEARANCE_BETWEEN_X_AND_Y        | Creatinine clearance (Cockcroft Gault formula) between X and Y. | In case CrCl is measured in another unit, the value is converted                                |
| HAS_MEASURED_CREATININE_CLEARANCE_OF_AT_LEAST_X | T.B.I.                                                          |                                                                                                 |

_Cardiac / cardiovascular function_

| Rule                                     | When does a patient pass evaluation?         | Note |
|------------------------------------------|----------------------------------------------|------|
| HAS_BNP_ULN_OF_AT_MOST_X                 | NT-pro-BNP (BNP) <= X*ULN                    |      |
| HAS_TROPONIN_IT_ULN_OF_AT_MOST_X         | High-sensitivity Troponin T (HSTNT) <= X*ULN |      |
| HAS_TRIGLYCERIDE_MMOL_PER_L_OF_AT_MOST_X | Triglyceride (TG) <= X                       |      |

_Pancreas function_

| Rule                         | When does a patient pass evaluation? | Note |
|------------------------------|--------------------------------------|------|
| HAS_AMYLASE_ULN_OF_AT_MOST_X | Amylase (AMYL) <= X*ULN              |      |
| HAS_LIPASE_ULN_OF_AT_MOST_X  | Lipase (LIPA) <= X*ULN               |      |

_Minerals_

| Rule                                                       | When does a patient pass evaluation?                                           | Note                                                                                                     |
|------------------------------------------------------------|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| HAS_ABNORMAL_ELECTROLYTE_LEVELS                            | Calcium, Phosphate, Magnesium, Potassium, or Sodium LLN<X<ULN (isOutsideRef=0) |
| HAS_CALCIUM_MG_PER_DL_OF_AT_MOST_X                         | Calcium (Ca) in mg/dL <= X                                                     | In case calcium is measured in mmol/L, the value is converted to mg/dL using Ca[mg/dL]=Ca[mmol/L]/0.2495 |
| HAS_CALCIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS             | Calcium (Ca) LLN<X<ULN (isOutsideRef=0)                                        |                                                                                                          |
| HAS_CORRECTED_CALCIUM_ULN_OF_AT_MOST_X                     | Calcium corrected (Ca_C) <= X*ULN                                              |                                                                                                          |
| HAS_CORRECTED_CALCIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS   | Calcium corrected (Ca_C) LLN<X<ULN (isOutsideRef=0)                            |                                                                                                          |
| HAS_IONIZED_CALCIUM_MMOL_PER_L_OF_AT_MOST_X                | Iononized calcium (B_ICA) in mmol/L <= X                                       |                                                                                                          |
| HAS_POTENTIAL_SYMPTOMATIC_HYPERCALCEMIA                    | `WARN` if calcium, ionized calcium or corrected calcium above ULN.             |
| HAS_MAGNESIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS           | Magnesium (MG) LLN<X<ULN (isOutsideRef=0)                                      |                                                                                                          |
| HAS_CORRECTED_MAGNESIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS | T.B.D. LLN<X<ULN (isOutsideRef=0)                                              |                                                                                                          |
| HAS_PHOSPHATE_MMOL_PER_L_OF_AT_MOST_X                      | Phosphate (Phos) in mmol/L <= X                                                |                                                                                                          |
| HAS_PHOSPHATE_ULN_OF_AT_MOST_X                             | Phosphate (Phos) <= X*ULN                                                      |                                                                                                          |
| HAS_POTASSIUM_MMOL_PER_L_OF_AT_LEAST_X                     | Potassium (K) in mmol/l => X                                                   |                                                                                                          |
| HAS_POTASSIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS           | Potassium (K) LLN<X<ULN (isOutsideRef=0)                                       |                                                                                                          |
| HAS_CORRECTED_POTASSIUM_WITHIN_INSTITUTIONAL_NORMAL_LIMITS | T.B.D. LLN<X<ULN (isOutsideRef=0)                                              |                                                                                                          |
| HAS_POTENTIAL_HYPOKALEMIA                                  | Potassium (K) <= LLN, or history of specific condition with DOID 4500          |                                                                                                          |
| HAS_POTENTIAL_HYPOMAGNESEMIA                               | Magnesium (MG) <= LLN, or history of specific condition with DOID 0060879      |                                                                                                          |
| HAS_POTENTIAL_HYPOCALCEMIA                                 | Calcium (Ca) <= LLN, or history of specific condition with DOID 0090109        |                                                                                                          |

_Hormones_

| Rule                                          | When does a patient pass evaluation?      | Note                                              |
|-----------------------------------------------|-------------------------------------------|---------------------------------------------------|
| HAS_SERUM_TESTOSTERONE_NG_PER_DL_OF_AT_MOST_X | Serum testosterone (T.B.D.) in ng/dL <= X |                                                   |
| HAS_CORTISOL_LLN_OF_AT_LEAST_X                | Cortisol in nmol/L => X*LLN               | Cortisol values should be measured in the morning |

_Tumor markers_

| Rule                           | When does a patient pass evaluation?     | Note |
|--------------------------------|------------------------------------------|------|
| HAS_AFP_ULN_OF_AT_LEAST_X      | Alpha fetoprotein (AFP) <= X*ULN         |      |
| HAS_CA125_ULN_OF_AT_LEAST_X    | CA 125 (C125) <= X*ULN                   |      |
| HAS_HCG_ULN_OF_AT_LEAST_X      | HCG + beta HCG (HCG) <= X*ULN            |      |
| HAS_LDH_ULN_OF_AT_MOST_X       | Lactate dehydrogenase (LDH) <= X*ULN     |      |
| HAS_PSA_UG_PER_L_OF_AT_LEAST_X | Prostate-specific antigen (PSA) => X     |      |
| HAS_PSA_LLN_OF_AT_LEAST_X      | Prostate-specific antigen (PSA) => X*LLN |      |

_Urine measurements_

| Rule                                                         | When does a patient pass evaluation?                    | Note |
|--------------------------------------------------------------|---------------------------------------------------------|------|
| HAS_TOTAL_PROTEIN_IN_URINE_OF_AT_LEAST_X                     | Total protein in urine (TE_U) in g/L => X.              |      |
| HAS_TOTAL_PROTEIN_IN_24H_URINE_OF_AT_LEAST_X                 | In g/24h. (T.B.D.) Currently resolves to `UNDETERMINED` |      |
| HAS_URINE_PROTEIN_TO_CREATININE_RATIO_MG_PER_MG_OF_AT_MOST_X | (T.B.D.) Currently resolves to `UNDETERMINED`           |      |

_Other_

| Rule                                                          | When does a patient pass evaluation?                         | Note |
|---------------------------------------------------------------|--------------------------------------------------------------|------|
| HAS_GLUCOSE_FASTING_PLASMA_MMOL_PER_L_OF_AT_MOST_X            | (T.B.D.) Currently resolves to `UNDETERMINED`                |      |
| HAS_THYROXINE_WITHIN_INSTITUTIONAL_NORMAL_LIMITS              | Free T4 (FT4) LLN<X<ULN (isOutsideRef=0)                     |      |
| HAS_FREE_TRIIODOTHYRONINE_WITHIN_INSTITUTIONAL_NORMAL_LIMITS  | Free T3 (FT3) LLN<X<ULN (isOutsideRef=0)                     |      |
| HAS_BOUND_TRIIODOTHYRONINE_WITHIN_INSTITUTIONAL_NORMAL_LIMITS | Bound T3 (T3) LLN<X<ULN (isOutsideRef=0)                     |      |
| HAS_TSH_WITHIN_INSTITUTIONAL_NORMAL_LIMITS                    | Thyroid Stimulating Hormone (TSH) LLN<X<ULN (isOutsideRef=0) |      |
| HAS_ANTI_HLA_ANTIBODIES_AGAINST_PDC_LINE                      | Resolves to `UNDETERMINED`                                   |      |

ULN = Upper Limit of Normal, LLN = Lower Limit of Normal; implemented as refLimitUp and refLimitLow, respectively.

Notes:

- For all lab values, the most recent available lab value (up to 90 days old) is evaluated.
- If the most recent lab value is within the requested range but more than 30 days old, the evaluation resolves to `WARN` instead of `PASS`
- If the most recent lab value is out of the requested range but inside the margin of error (10%), the evaluation resolves
  to `(recoverable) UNDETERMINED `
- If the most recent lab value is out of the requested range and outside the margin of error, the evaluation resolves to `FAIL`.

##### Rules related to other conditions

| Rule                                                                | When does a patient pass evaluation?                                                                                                                                                                                                         | Note                                                                                                                                                |
|---------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_HISTORY_OF_SPECIFIC_CONDITION_WITH_DOID_TERM_X                  | Prior other conditions > any configured DOID should be equal or be a child of DOID belonging to term "X"                                                                                                                                     |                                                                                                                                                     |
| HAS_HISTORY_OF_SPECIFIC_CONDITION_WITH_DOID_TERM_X_WITHIN_Y_MONTHS  | Prior other conditions > any configured doid should be equal or be a child of the configured doid term input, and date should be <= X months.                                                                                                | In case the condition occurred within the last 2 months as limited by X, resolve to `WARN`. When date is not known, resolve to `UNDETERMINED`       |
| HAS_HISTORY_OF_SPECIFIC_CONDITION_X_BY_NAME                         | Prior other conditions > name like %X%                                                                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_SPECIFIC_CONDITION_X_BY_NAME_WITHIN_Y_MONTHS         | Prior other conditions > name like %X%, and date should be <= Y months ago.                                                                                                                                                                  | In case the condition with name X occurred within 2 months of the target date, resolve to `WARN`. When date is not known, resolve to `UNDETERMINED` |
| HAS_HISTORY_OF_AUTOIMMUNE_DISEASE                                   | Prior other conditions > any configured doid should be equal or be a child of DOID 417                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_BRAIN_DISEASE                                        | Prior other conditions > any configured doid should be equal or be a child of DOID 936                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_CARDIAC_DISEASE                                      | Prior other conditions > any configured doid should be equal or be a child of DOID 114 (heart disease) or DOID 3393 (coronary artery disease), or complication or toxicity with categories like %Cardiac disease%                            |                                                                                                                                                     |
| HAS_HISTORY_OF_CARDIOVASCULAR_DISEASE                               | Prior other conditions > any configured doid should be equal or be a child of DOID 1287                                                                                                                                                      |                                                                                                                                                     |
| HAS_HISTORY_OF_CONGESTIVE_HEART_ FAILURE_WITH_AT_LEAST_NYHA_CLASS_X | Resolve to `WARN` in case any configured doid equal or a child of DOID 6000                                                                                                                                                                  | X should be one of: I, II, III, IV                                                                                                                  |
| HAS_HISTORY_OF_CENTRAL_NERVOUS_ SYSTEM_DISEASE                      | Prior other conditions > any configured doid should be equal or be a child of DOID 331                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_EYE_DISEASE                                          | Prior other conditions > any configured doid should be equal or be a child of DOID 5614, or complication or toxicity with categories like %Eye disease%                                                                                      |                                                                                                                                                     |
| HAS_HISTORY_OF_GASTROINTESTINAL_DISEASE                             | Prior other conditions > any configured doid should be equal or be a child of DOID 77                                                                                                                                                        |                                                                                                                                                     |
| HAS_HISTORY_OF_IMMUNE_SYSTEM_DISEASE                                | Prior other conditions > any configured doid should be equal or be a child of DOID 2914                                                                                                                                                      |                                                                                                                                                     |
| HAS_HISTORY_OF_INTERSTITIAL_LUNG_DISEASE                            | Prior other conditions > any configured doid should be equal or be a child of DOID 3082                                                                                                                                                      |                                                                                                                                                     |
| HAS_POTENTIAL_RESPIRATORY_COMPROMISE                                | Currently not evaluated.                                                                                                                                                                                                                     |                                                                                                                                                     |
| HAS_HISTORY_OF_LIVER_DISEASE                                        | Prior other conditions > any configured doid should be equal or be a child of DOID 409                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_LUNG_DISEASE                                         | Prior other conditions > any configured doid should be equal or be a child of DOID 850                                                                                                                                                       |                                                                                                                                                     |
| HAS_HISTORY_OF_MYOCARDIAL_INFARCT                                   | Prior other conditions > any configured doid should be equal or be a child of DOID 5844                                                                                                                                                      |                                                                                                                                                     |
| HAS_HISTORY_OF_MYOCARDIAL_INFARCT _WITHIN_X_MONTHS                  | Prior other conditions > any configured doid should be equal or be a child of DOID 5844, and date should be <= X months.                                                                                                                     | In case myocardial infarct occurred within the last 2 months as limited by X, resolve to `WARN`. When date is not known, resolve to `UNDETERMINED`  |
| HAS_HISTORY_OF_PNEUMONITIS                                          | Prior other conditions > any configured DOID should be equal or be a child of DOID 2797; Toxicity > Name like %pneumonia% or %pneumonitis% with grade => 2 (following Toxicity specific logic as described later)                            |                                                                                                                                                     |
| HAS_HISTORY_OF_STROKE                                               | Prior other conditions > any configured doid should be equal or be a child of DOID 6713, or complication or toxicty with categories like %Cerebrovascular accident%                                                                          |                                                                                                                                                     |
| HAS_HISTORY_OF_STROKE_WITHIN_X_MONTHS                               | Prior other conditions > any configured doid should be equal or be a child of DOID 6713, and date should be <= X months.                                                                                                                     |                                                                                                                                                     |
| HAS_HISTORY_OF_THROMBOEMBOLIC_EVENT                                 | Prior other conditions > any configured DOID should be equal or be a child of DOID 0060903, 9477, 5844 or 6713.                                                                                                                              | Resolve to `WARN` in case history with DOID 6713 or 5844 or 326                                                                                     |
| HAS_HISTORY_OF_THROMBOEMBOLIC_EVENT_WITHIN_X_MONTHS                 | Prior other conditions > any configured DOID should be equal or be a child of DOID 0060903, 9477, 5844 or 6713, and date should be <= X months.                                                                                              |                                                                                                                                                     |
| HAS_HISTORY_OF_ARTERIAL_THROMBOEMBOLIC_EVENT                        | Prior other conditions > any configured DOID should be equal or be a child of DOID 5844 or 6713.                                                                                                                                             | Resolve to `WARN` in case history with DOID 0060903, 6713, 5844 or 326, or complication of category 'Thromboembolic event'                          |
| HAS_HISTORY_OF_VENOUS_THROMBOEMBOLIC_EVENT                          | Prior other conditions > any configured DOID should be equal or be a child of DOID 0060903 or 9477                                                                                                                                           | Resolve to `WARN` in case history with DOID 0060903, 6713 or 5844 or complication of category 'Thromboembolic event'                                |
| HAS_HISTORY_OF_VASCULAR_DISEASE                                     | Prior other conditions > any configured doid should be equal or be a child of DOID 178                                                                                                                                                       |                                                                                                                                                     |
| HAS_SEVERE_CONCOMITANT_CONDITION                                    | `WARN` in case of WHO 3 or 4. `PASS` in case of WHO 5. Otherwise (WHO null or ≤2), it is assumed there are none.                                                                                                                             |                                                                                                                                                     |
| HAS_HAD_ORGAN_TRANSPLANT                                            | Prior other conditions > categories contains "Organ transplant"                                                                                                                                                                              |                                                                                                                                                     |
| HAS_HAD_ORGAN_TRANSPLANT_WITHIN_X_YEARS                             | Prior other conditions > categories contains "Organ transplant" and years ago <= X                                                                                                                                                           | `UNDETERMINED` in case year is unknown                                                                                                              |
| HAS_GILBERT_DISEASE                                                 | Prior other conditions > any configured doid should be equal or be a child of DOID 2739                                                                                                                                                      |                                                                                                                                                     |
| HAS_HYPERTENSION                                                    | Prior other conditions > any configured doid should be equal or be a child of DOID 10763                                                                                                                                                     |                                                                                                                                                     |
| HAS_HYPOTENSION                                                     | Prior other conditions > name like %hypotension%                                                                                                                                                                                             |                                                                                                                                                     |
| HAS_DIABETES                                                        | Prior other conditions > any configured doid should be equal or be a child of DOID 9351                                                                                                                                                      |                                                                                                                                                     |
| HAS_INHERITED_PREDISPOSITION_TO_BLEEDING_OR_THROMBOSIS              | Prior other conditions > any configured doid should be equal or be a child of DOIDs 0111823, 12259, 12531, 2216, 3756, 245 or 3755, or name should contain "factor V Leiden"                                                                 |                                                                                                                                                     |
| HAS_POTENTIAL_ABSORPTION_DIFFICULTIES                               | Or: Prior other condition belonging to DOID 77, Complication of category like %Gastrointestinal disorder%, Toxicity source questionnaire or EHR grade=>2 of name %Diarrhea%, %Nausea%, %Vomit%                                               |                                                                                                                                                     |
| HAS_POTENTIAL_ORAL_MEDICATION_DIFFICULTIES                          | Or: Has complication of name %tube%, %swallow% (T.B.D.)                                                                                                                                                                                      |                                                                                                                                                     |
| HAS_POTENTIAL_CONTRAINDICATION_TO_CT                                | > prior other condition > name like %claustrophobia% or any other condition belonging to DOID 557, or intolerance name like %contrast agent%, or pregnancy, or medication use of name %metformin%, or complication of name %hyperthyroidism% |                                                                                                                                                     |
| HAS_POTENTIAL_CONTRAINDICATION_TO_MRI                               | > prior other condition > category like %Implant% or name like %Claustrophobia% or any other condition belonging to DOID 557, or intolerance name like %contrast agent%                                                                      |                                                                                                                                                     |
| HAS_POTENTIAL_CONTRAINDICATION_TO_PET_MRI                           | > Same contraindications as for HAS_POTENTIAL_CONTRAINDICATION_TO_MRI, and: (T.B.D.)                                                                                                                                                         |                                                                                                                                                     |
| HAS_MRI_SCAN_DOCUMENTING_STABLE_DISEASE                             | Currently resolves to `WARN`                                                                                                                                                                                                                 |                                                                                                                                                     |
| IS_IN_DIALYSIS                                                      | Won't be evaluated                                                                                                                                                                                                                           |                                                                                                                                                     |
| HAS_CHILD_PUGH_CLASS_X_LIVER_SCORE                                  | Currently resolves to `NOT_EVALUATED` when liver cirrhosis is not present in medical history. Resolves to `UNDETERMINED` in case of liver cirrhosis.                                                                                         | X can be one of: A, B, C                                                                                                                            |
| HAS_POTENTIAL_CONTRAINDICATION_FOR_STEREOTACTIC_RADIOSURGERY        | Currently not evaluated.                                                                                                                                                                                                                     |                                                                                                                                                     |
| HAS_ADEQUATE_VENOUS_ACCESS                                          | Currently resolves to `NOT_EVALUATED`                                                                                                                                                                                                        |                                                                                                                                                     |


Note:
For all Prior other conditions applies that in case the condition is indicated as having no contraindication for therapy (
isContraindicationForTherapy=0), the condition is ignored for evaluation.

##### Rules related to cardiac function

| Rule                                          | When does a patient pass evaluation?                                                                                                                                                            |
|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_POTENTIAL_SIGNIFICANT_HEART_DISEASE       | Clinical status > hasSigAberrationLatestECG = 1, or Prior other conditions > any configured doid should be equal or be a child of DOID 114, 10763 or 3393, or name like %angina% or %pacemaker% |
| HAS_ECG_ABERRATION                            | Clinical status > hasSigAberrationLatestECG = 1                                                                                                                                                 |
| HAS_LVEF_OF_AT_LEAST_X                        | clinicalStatus > lvef should be => x. Unavailable LVEF data leads to `NOT_EVALUATED`, out of range LVEF leads to `FAIL`                                                                         |
| HAS_QTC_OF_AT_MOST_X                          | QTcF or QTcB. Currently: Clinical status > qtcfValue in ms <= X                                                                                                                                 |
| HAS_QTCF_OF_AT_MOST_X                         | Clinical status > qtcfValue in ms <= X                                                                                                                                                          |
| HAS_QTCF_OF_AT_MOST_X_WITH_GENDER_Y           | Clinical status > qtcfValue in ms <= X and gender equal to Y                                                                                                                                    |
| HAS_QTCF_OF_AT_LEAST_X                        | Clinical status > qtcfValue in ms => X                                                                                                                                                          |
| HAS_QTCF_OF_AT_LEAST_X_WITH_GENDER_Y          | Clinical status > qtcfValue in ms => X and gender equal to Y                                                                                                                                    |
| HAS_JTC_OF_AT_LEAST_X                         | Clinical status > jtcValue in ms <= X                                                                                                                                                           |
| HAS_LONG_QT_SYNDROME                          | Prior other conditions > any configured doid should be equal or be a child of DOID 2843                                                                                                         |
| HAS_NORMAL_CARDIAC_FUNCTION_BY_MUGA_OR_TTE    | Resolve to `WARN` in case LVEF is known and < 50%, otherwise resolve to `NOT_EVALUATED`                                                                                                         |
| HAS_FAMILY_HISTORY_OF_IDIOPATHIC_SUDDEN_DEATH | Currently resolves to `UNDETERMINED`                                                                                                                                                            |
| HAS_FAMILY_HISTORY_OF_LONG_QT_SYNDROME        | Currently resolves to `UNDETERMINED`                                                                                                                                                            |

##### Rules related to infections

| Rule                                                    | When does a patient pass evaluation?                                                   | Note                                                                         |
|---------------------------------------------------------|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
| HAS_ACTIVE_INFECTION                                    | Clinical status > hasActiveInfection = 1                                               | `WARN` in case patient uses medication of category 'systemic antimicrobials' |
| HAS_KNOWN_EBV_INFECTION                                 | Prior other conditions > name like %EBV% or %Epstein Barr%                             |                                                                              |
| HAS_KNOWN_HEPATITIS_A_INFECTION                         | Prior other conditions > configured doid should be equal or be a child of DOID 12549   |                                                                              |
| HAS_KNOWN_HEPATITIS_B_INFECTION                         | Prior other conditions > configured doid should be equal or be a child of DOID 2043    |                                                                              |
| HAS_KNOWN_HEPATITIS_C_INFECTION                         | Prior other conditions > configured doid should be equal or be a child of DOID 1883    |                                                                              |
| HAS_KNOWN_HIV_INFECTION                                 | Prior other conditions > configured doid should be equal or be a child of DOID 526     |                                                                              |
| HAS_KNOWN_CYTOMEGALOVIRUS_INFECTION                     | Prior other conditions > configured doid should be equal or be a child of DOID 0080827 |                                                                              |
| HAS_KNOWN_TUBERCULOSIS_INFECTION                        | Prior other conditions > configured doid should be equal or be a child of DOID 399     |                                                                              |
| MEETS_COVID_19_INFECTION_REQUIREMENTS                   | Currently resolves to `UNDETERMINED`                                                   |                                                                              |
| HAS_RECEIVED_LIVE_VACCINE_WITHIN_X_MONTHS               | Currently resolves to `UNDETERMINED`                                                   |                                                                              |
| HAS_RECEIVED_NON_LIVE_VACCINE_WITHIN_X_WEEKS            | Currently resolves to `UNDETERMINED`                                                   |                                                                              |
| ADHERENCE_TO_PROTOCOL_REGARDING_ ATTENUATED_VACCINE_USE | Won't be evaluated                                                                     |                                                                              |

##### Rules related to current medication

| Rule                                                                       | When does a patient pass evaluation?                                                                                                                                                                                                           | Note                                                                                                         |
|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| CURRENTLY_GETS_NAME_X_MEDICATION                                           | Medication > name like %X% and status is active                                                                                                                                                                                                | Resolve to `WARN` in case planned medication with name X                                                     |
| CURRENTLY_GETS_CATEGORY_X_MEDICATION                                       | Medication > atc.<atcLevel>.code equal to <category> where <atcLevel> is a level defined below in 3] and <category> is X OR a member of the set of ATC codes derived from X using the table below in 4]; and status is active                  | Resolve to `WARN` in case planned medication with category X                                                 |
| HAS_RECEIVED_CATEGORY_X_MEDICATION_ WITHIN_Y_WEEKS                         | Medication > atc.<atcLevel>.code equal to <category> where <atcLevel> is a level defined below in 3] and <category> is X OR a member of the set of ATC codes derived from X using the table below in 4]; and active OR stopDate within Y weeks | `UNDETERMINED` in case Y would require stop dates to be prior to ACTIN registration date.                    |
| CURRENTLY_GETS_POTENTIALLY_QT_PROLONGATING_MEDICATION                      | Medication > qtProlongatingRisk contains type of "Known", "Potential" or "Conditional" and status is active                                                                                                                                    | Resolve to `WARN` in case planned QT prolongating medication                                                 |
| CURRENTLY_GETS_MEDICATION_INDUCING_ANY_CYP                                 | Medication > cypInteractions.type is "Inducer" and status is active                                                                                                                                                                            | Resolve to `WARN` in case planned CYP inducing medication                                                    |                                                                                           
| CURRENTLY_GETS_MEDICATION_INHIBITING_CYP_X                                 | Medication > cypInteractions.cyp like %X% and cypInteractions.type is "Inhibitor" and status is active                                                                                                                                         | `UNDETERMINED` in case X = CYP2J2. Resolve to `WARN` in case planned CYP X inhibiting medication             |
| CURRENTLY_GETS_MEDICATION_INDUCING_CYP_X                                   | Medication > cypInteractions.cyp like %X% and cypInteractions.type is "Inducer" and status is active                                                                                                                                           | `UNDETERMINED` in case X = CYP2J2. Resolve to `WARN` in case planned CYP X inducing medication               |
| HAS_RECEIVED_MEDICATION_INDUCING_CYP_X_WITHIN_Y_WEEKS                      | Medication > cypInteractions.cyp like %X% and cypInteractions.type is "Inducer" and status is active or stopDate within Y weeks                                                                                                                | `UNDETERMINED` in case X = CYP2J2                                                                            |
| CURRENTLY_GETS_MEDICATION_INHIBITING_OR_INDUCING_ANY_CYP                   | Medication > cypInteractions.type is "Inhibitor" or "Inducer" and status is active                                                                                                                                                             | Resolve to `WARN` in case planned CYP inhibiting or inducing medication                                      |
| CURRENTLY_GETS_MEDICATION_INHIBITING_OR_INDUCING_CYP_X                     | Medication > cypInteractions.cyp like %X% and cypInteractions.type is "Inhibitor" or "Inducer" and status is active                                                                                                                            | `UNDETERMINED` in case X = CYP2J2. Resolve to `WARN` in case planned CYP X inhibiting or inducing medication |
| CURRENTLY_GETS_MEDICATION_SUBSTRATE_OF_CYP_X                               | Medication > cypInteractions.cyp like %X% and cypInteractions.type is "Substrate" and status is active                                                                                                                                         | `UNDETERMINED` in case X = CYP2J2. Resolve to `WARN` in case planned CYP X substrate medication              |
| CURRENTLY_GETS_MEDICATION_INDUCING_PGP                                     | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | P-glycoprotein. `FAIL` in case patient uses no medication                                                    |
| CURRENTLY_GETS_MEDICATION_INHIBITING_PGP                                   | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | `FAIL` in case patient uses no medication                                                                    |
| CURRENTLY_GETS_MEDICATION_SUBSTRATE_OF_PGP                                 | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | `FAIL` in case patient uses no medication                                                                    |
| CURRENTLY_GETS_MEDICATION_INDUCING_BCRP                                    | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | `FAIL` in case patient uses no medication                                                                    |      
| CURRENTLY_GETS_MEDICATION_INHIBITING_BCRP                                  | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | Breast cancer resistance protein. `FAIL` in case patient uses no medication                                  |
| CURRENTLY_GETS_MEDICATION_SUBSTRATE_OF_BCRP                                | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | `FAIL` in case patient uses no medication                                                                    |
| CURRENTLY_GETS_MEDICATION_SUBSTRATE_OF_OATP1B1B3                           | T.B.D., currently resolves to `UNDETERMINED`                                                                                                                                                                                                   | Organic anion transporting polypeptide. `FAIL` in case patient uses no medication                            |
| CURRENTLY_GETS_MEDICATION_INHIBITING_OR_INDUCING_DRUG_METABOLIZING_ENZYMES | Currently resolves to `WARN` in case patient receives any medication                                                                                                                                                                           |                                                                                                              |
| HAS_STABLE_ANTICOAGULANT_MEDICATION_DOSING                                 | Medication > atc.<atcLevel>.code like "Anticoagulant medication" in 4] AND only 1 distinct dosage (T.B.D)                                                                                                                                      |                                                                                                              |
| CURRENTLY_GETS_HERBAL_MEDICATION                                           | `UNDETERMINED` if medication isSelfCare = true and status is active or planned                                                                                                                                                                 |                                                                                                              |

3] anatomicalMainGroup, therapeuticSubGroup, pharmacologicalSubGroup OR chemicalSubGroup

4] Medication category list (with corresponding ATC level codes between brackets): <br>
Anticoagulants ("B01AA", "B01AB", "B01AC", "B01AD", "B01AE", "B01AF" or "B01AX") <br>
Antiepileptics ("N03") <br>
Antiinflammatory and antirheumatic products ("M01") <br>
Antineoplastic agents ("L01") <br>
Azole ("A07AC", "D01AC", "G01AF", "G01BF", "G01AG", "J02AC" or "J02AB") <br>
Bisphosphonates ("M05BA" or "M05BB") <br>
Bone resorptive ("M05B" or "H05") <br>
Colony stimulating factors ("L03AA") <br>
Coumarin derivative ("B01AA") <br>
Gonadorelin ("H01CC", "H01CA", "G03XA" or "L02AE") <br>
Immunostimulants ("L03") <br>
Immunosuppressants ("L04") <br>
Nitrosoureas ("L01AD") <br>
Other antianemic preparations ("B03X") <br>
Platelet aggregation inhibitors ("B01AC") <br>
RANKL targeting agents ("M05BX04") <br>
Systemic antibiotics ("A07A", "G01AA", "R02AB", "J01") <br>
Systemic antimicrobials = systemicAntibiotics + systemicAntimycobacterials + systemicAntimycotics + systemicAntivirals <br>
Systemic antimycobacterials ("J04") <br>
Systemic antimycotics ("J02") <br>
Systemic antivirals ("J05") <br>
Systemic corticosteroids ("H02" or "M01BA") <br>

##### Rules related to washout period

| Rule                                                                               | When does a patient pass evaluation?                                                                                                                                                                                                                                        | Note                                                                                                                                                                                        |
|------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_RECEIVED_DRUGS_X_CANCER_THERAPY_WITHIN_Y_WEEKS                                 | Medication > any names like %X% and active Y weeks prior to evaluation date OR Treatment history > contains entry with drug in X occurring within Y weeks                                                                                                                   | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`.                                                                                                      |
| HAS_RECEIVED_DRUGS_X_CANCER_THERAPY_WITHIN_Y_WEEKS_Z_HALF_LIVES                    | Medication > any names like %X% and active Y weeks prior to evaluation date and Z half lives OR Treatment history > contains entry with drug in X occurring within Y weeks and Z half lives                                                                                 | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Half-lives is currently ignored.                                                                     |
| HAS_RECEIVED_CATEGORIES_X_CANCER_THERAPY_WITHIN_Y_WEEKS                            | Medication > atc.<atcLevel>.code equal to <category>* and  active Y weeks prior to evaluation OR Treatment history > contains entry with treatment with category X*** within Y weeks                                                                                        | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`.                                                                                                      |
| HAS_RECEIVED_CATEGORIES_X_CANCER_THERAPY_WITHIN_Y_WEEKS_Z_HALF_LIVES               | Medication > atc.<atcLevel>.code equal to <category>* and active Y weeks prior to evaluation and Z half lives OR Treatment history > contains entry with treatment with category X*** within Y weeks and Z half lives                                                       | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Half-lives is currently ignored.                                                                     |
| HAS_RECEIVED_TRIAL_MEDICATION_WITHIN_X_WEEKS                                       | Medication > isTrialMedication is true and active or stopDate within X weeks OR Treatment history > Entry with isTrial set to true occurring within Y weeks                                                                                                                 | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`.                                                                                                      |
| HAS_RECEIVED_TRIAL_MEDICATION_WITHIN_X_WEEKS_Y_HALF_LIVES                          | Medication > isTrialMedication is true and active X weeks prior to evaluation and Y half lives OR Treatment history > Entry with isTrial set to true occurring within Y weeks and Z half lives                                                                              | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Half-lives is currently ignored.                                                                     |
| HAS_RECEIVED_RADIOTHERAPY_WITHIN_X_WEEKS                                           | Radiotherapy in treatment history when: 1] no date provided; 2] in case only a year is provided then in case of current year; 3] in case year+month is provided then in case of current year and current month                                                              |                                                                                                                                                                                             |
| HAS_HAD_RADIOTHERAPY_TO_BODY_LOCATION_X_WITHIN_Y_WEEKS                             | Radiotherapy in treatment history with body location X and within the requested timeframe (only year compared to reference if month not provided in history).                                                                                                               | `UNDETERMINED` if the year is unknown or if any entries have an unknown body location                                                                                                       |
| HAS_RECEIVED_ANY_ANTI_CANCER_THERAPY_WITHIN_X_WEEKS                                | Medication > atc.<atcLevel>.code equal to <category>** and active X weeks prior to evaluation date OR Treatment history > contains entry with treatment with category anti cancer category*** within X weeks                                                                | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Does not include radiotherapy or surgery, these are separate rules.                                  |
| HAS_RECEIVED_ANY_ANTI_CANCER_THERAPY_EXCL_CATEGORIES_X_WITHIN_Y_WEEKS              | Medication > atc.<atcLevel>.code equal to <category>**, excluding ATC codes equal to X or if X present in 5] use derived ATC codes OR Treatment history > contains entry with treatment with anti cancer category *** ignoring categories X within Y weeks                  | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Does not include radiotherapy or surgery, these are separate rules.                                  |
| HAS_RECEIVED_ANY_ANTI_CANCER_THERAPY_WITHIN_X_WEEKS_Y_HALF_LIVES                   | Medication > atc.<atcLevel>.code equal to <category>** and active X weeks prior to evaluation date OR Treatment history > contains entry with treatment with category anti cancer category*** within X weeks and Y half lives                                               | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Half-lives is currently ignored. Does not include radiotherapy or surgery, these are separate rules. |
| HAS_RECEIVED_ANY_ANTI_CANCER_THERAPY_EXCL_CATEGORIES_X_WITHIN_Y_WEEKS_Z_HALF_LIVES | Medication > atc.<atcLevel>.code equal to <category>**, excluding ATC codes equal to X OR if X present in 5] use derived ATC codes OR Treatment history > contains entry with treatment with anti cancer category *** ignoring categories X within Y weeks and Z half lives | If no startDate configured, or startDate is not conclusive, resolve to `UNDETERMINED`. Half-lives currently ignored. Does not include radiotherapy or surgery, these are separate rules.    |

*Where <atcLevel> is a level defined above in 3] and <category> is X OR a member of the set of ATC codes derived from X using the table
below in 5]
**Where <atcLevel> is a level defined above in 3] and <category> is equal to "L01", "L02", "L04" OR a member of the set of ATC codes derived
from "Gonadorelin" using the table below in 5]
***Categories are mapped to corresponding Treatment 'Categories' and 'Types'

5] Cancer therapy list (with corresponding ATC level codes between brackets): <br>
Chemotherapy ("L01XA", "L01BC", "L01CD" or "L01A") <br>
Endocrine therapy ("L02") <br>
Gonadorelin ("H01CC", "H01CA", "G03XA" or "L02AE") <br>
Hypomethylating agents ("L01BC07" (Azacitidine) or "L01BC08" (Decitabine)) <br>
Immunotherapy ("L01FF" or "L01FX04" (Ipilimumab)) <br>
Monoclonal antibodies and antibody drug conjugates ("L01F") <br>
PARP inhibitors ("L01XK") <br>

Note that for all configured nr of weeks, 2 weeks are subtracted from the latest medication date, since these weeks will pass by anyway.

##### Rules related to reproduction

| Rule                                           | When does a patient pass evaluation?          |
|------------------------------------------------|-----------------------------------------------|
| IS_BREASTFEEDING                               | Applicable only for women. Won't be evaluated |
| IS_PREGNANT                                    | Applicable only for women. Won't be evaluated |
| USES_ADEQUATE_ANTICONCEPTION                   | Won't be evaluated                            |
| ADHERES_TO_SPERM_OR_EGG_DONATION_PRESCRIPTIONS | Won't be evaluated                            |

##### Rules related to complications

| Rule                                          | When does a patient pass evaluation?                                                                                  | Note                                                                                                  |
|-----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| HAS_ANY_COMPLICATION                          | complication > Any entry                                                                                              | `UNDETERMINED` in case complication details unknown                                                   |
| HAS_COMPLICATION_X                            | complication > Name like %X%                                                                                          | `UNDETERMINED` in case complication details unknown                                                   |
| HAS_COMPLICATION_OF_CATEGORY_X                | complication > Categories like %X%                                                                                    | `UNDETERMINED` in case complication details unknown                                                   |
| HAS_POTENTIAL_UNCONTROLLED_TUMOR_RELATED_PAIN | complication > Categories like %Pain% or current use of medication with pharmacologicalSubgroupAtc 'OPIOIDS' (T.B.D.) |                                                                                                       |
| HAS_LEPTOMENINGEAL_DISEASE                    | complication > Categories like %leptomeningeal disease%                                                               | `WARN` in case of hasCnsLesions=1 or otherLesions like %leptomeningeal% or %carcinomatous%meningitis% |

##### Rules related to intolerances/toxicities

| Rule                                              | When does a patient pass evaluation?                                                                                                                                   | Note                                                                                |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| HAS_INTOLERANCE_TO_NAME_X                         | Intolerance > Name like %X%                                                                                                                                            |                                                                                     |
| HAS_INTOLERANCE_BELONGING_TO_DOID_TERM_X          | Intolerance > doid is equal of a child of doid belonging to term X                                                                                                     |                                                                                     |
| HAS_INTOLERANCE_TO_PLATINUM_COMPOUNDS             | Intolerance > Name contains any platinum compound                                                                                                                      |                                                                                     |
| HAS_INTOLERANCE_TO_TAXANE                         | Intolerance > Name contains any taxane                                                                                                                                 | Taxanes: Paclitaxel, Docetaxel, Cabazitaxel                                         |
| HAS_INTOLERANCE_RELATED_TO_STUDY_MEDICATION       | Intolerance > Resolves to `UNDETERMINED` in case of presence of any active allergies belonging to categories in 'Medication' and/or DOID 0060500                       |                                                                                     |
| HAS_INTOLERANCE_FOR_PD_1_OR_PD_L1_INHIBITORS      | Intolerance > Name matches any of Pembrolizumab, Nivolumab, Cemiplimab, Avelumab, Atezolizumab, Durvalumab, PD-1, PD-L1                                                | `WARN` if clinically relevant prior condition doid represents an autoimmune disease |
| HAS_HISTORY_OF_ANAPHYLAXIS                        | Resolves to `UNDETERMINED` in case of presence of any allergies (T.B.D.)                                                                                               |                                                                                     |
| HAS_EXPERIENCED_IMMUNE_RELATED_ADVERSE_EVENTS     | Resolves to `WARN` in case of previous treatment with categories like immunotherapy and TODO (ACTIN-35): (stopReason like %toxicity% or present toxicities => grade 2) |                                                                                     |
| HAS_TOXICITY_CTCAE_OF_AT_LEAST_GRADE_X            | Toxicities > grade => X                                                                                                                                                |                                                                                     |
| HAS_TOXICITY_CTCAE_OF_AT_LEAST_GRADE_X_IN_Y       | Toxicities > grade => X and name like %Y%                                                                                                                              |                                                                                     |
| HAS_TOXICITY_ASTCT_OF_AT_LEAST_GRADE_X_IN_Y       | Toxicities > grade => X and name like %Y%                                                                                                                              |                                                                                     |
| HAS_TOXICITY_CTCAE_OF_AT_LEAST_GRADE_X_IGNORING_Y | Toxicities > grade => X and ignoring name like %Y%                                                                                                                     | Multiple names can be specified within 1 rule, separated by ";"                     |

Note for all TOXICITY rules:

- In case X = 0, 1 or 2, all names corresponding to 'source = Questionnaire' are included (also if 'grade' is unknown), since toxicities are
  only noted in questionnaire when grade => 2.
  In case X = 3 or 4, the evaluation resolves to `UNDETERMINED` if there are names for which grade is not specified.
- For all EHR toxicities, ignore the toxicity if the name of the toxicity is also indicated as a complication
- For all EHR toxicities, only the most recent toxicity examination per toxicity is considered for evaluation.
- In case toxicity evaluation resolves to `PASS` without support of at least one questionnaire toxicity, the evaluation resolves to `WARN`
  instead.

##### Rules related to vital function / body weight measurements

| Rule                                   | When does a patient pass evaluation?                                                                                                                                                |
|----------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_SBP_MMHG_OF_AT_LEAST_X             | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median systolic blood pressure value => X  |
| HAS_SBP_MMHG_OF_AT_MOST_X              | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median systolic blood pressure value <= X  |
| HAS_DBP_MMHG_OF_AT_LEAST_X             | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median diastolic blood pressure value => X |
| HAS_DBP_MMHG_OF_AT_MOST_X              | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median diastolic blood pressure value <= X |
| HAS_PULSE_OXIMETRY_OF_AT_LEAST_X       | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median SpO2 (in percent) => X              |
| HAS_RESTING_HEART_RATE_BETWEEN_X_AND_Y | vitalFunction > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median heart rate (in BPM) between X and Y |
| HAS_BODY_WEIGHT_OF_AT_LEAST_X          | bodyWeight > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median body weight (in kg) => X               |
| HAS_BODY_WEIGHT_OF_AT_MOST_X           | bodyWeight > Include median of up to 5 different days (most recent value within a month, other values within 2 months), with over all median body weight (in kg) <= X               |
| HAS_BMI_OF_AT_MOST_X                   | Patient BMI estimate from body weight <= X for patients between 1.5 and 2.0 m                                                                                                       |

Notes:

- If the vital function measurement is below the requested minimum value or above the requested maximum value, the evaluation resolves
  to `(recoverable) UNDETERMINED` if the deviation is within the 5 percent margin of error and to `FAIL` otherwise.

##### Rules related to blood transfusions

| Rule                                                | When does a patient pass evaluation?                                                                                                                                                                          |
|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| REQUIRES_REGULAR_HEMATOPOIETIC_SUPPORT              | Blood transfusions > Presence of entries within 2 months of evaluation date or Medication > presence of entries within 2 months of evaluation date with atc.chemicalSubGroup.code equal to "B03XA" OR "L03AA" |
| HAS_HAD_ERYTHROCYTE_TRANSFUSION_WITHIN_LAST_X_WEEKS | Blood transfusions > product = Erythrocyte concentrate AND current date minus transfusion date <= X weeks                                                                                                     |
| HAS_HAD_THROMBOCYTE_TRANSFUSION_WITHIN_LAST_X_WEEKS | Blood transfusions > product = Thrombocyte concentrate AND current date minus transfusion date <= X weeks                                                                                                     |

##### Rules related to surgery

| Rule                                 | When does a patient pass evaluation?                                                                                                                                                                                                    | Note                                                                                                                                                                                                  |
|--------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| HAS_HAD_RECENT_SURGERY               | Surgeries > Presence of surgery entry within 2 months, or Treatment history > any treatment with category 'surgery' and start date <= 2 months.                                                                                         | In case treatment with category 'surgery' is present but no date available, resolve to `UNDETERMINED`                                                                                                 |
| HAS_HAD_SURGERY_WITHIN_LAST_X_WEEKS  | Surgeries > Current date minus latest surgery date <= X weeks, or Treatment history > any treatment with category 'surgery' and start date <= X weeks. X should be <= 8, in case nr of weeks is higher, below rule should be used       | Note that X is the protocol nr of weeks. Therefore 2 weeks are subtracted from the latest surgery date. In case treatment with category 'surgery' is present but no date available, resolve to `FAIL` |
| HAS_HAD_SURGERY_WITHIN_LAST_X_MONTHS | Surgeries > Current date minus latest surgery date <= X months, or Treatment history > any treatment with category 'surgery' and start date <= X months. X should be => 2, in case nr of months is lower, the above rule should be used | In case treatment with category 'surgery' is present but no date available, resolve to `UNDETERMINED`                                                                                                 |
| HAS_PLANNED_SURGERY                  | Surgeries > Presence of surgery entry after current date, or Treatment history > any treatment with category 'surgery' and start date after current date.                                                                               | In case treatment with category 'surgery' is present but no date available, resolve to `UNDETERMINED`                                                                                                 |
| HAS_HAD_CYTOREDUCTIVE_SURGERY        | Treatment history > Treatment with category 'Surgery' and type 'Cytoreductive' OR Treatment history > treatment name contains 'HIPEC'                                                                                                   | In case treatment with category 'surgery' is present but surgery not specified OR Treatment history > Treatment with category 'Surgery' and type 'Debulking', resolve to `UNDETERMINED`               |

#### Standard of Care (SOC)

As we broaden the scope of treatment matching to support patients who may not have exhausted standard of care (SOC), we need a SOC model
to determine if standard treatments are still available or required for a given patient. Eventually, we could make recommendations based
on efficacy data from the latest research. Standard treatment eligibility can be represented in the same way as trial eligibility, using
the functions described above.

The SOC recommendation application can be run as follows:

```
java -cp actin.jar com.hartwig.actin.algo.soc.StandardOfCareApplicationKt \
    -clinical_json /path/to/clinical.json \
    -molecular_json /path/to/molecular.json \
    -doid_json /path/to/doid.json \
    -atc_tsv /path/to/atc_tree.tsv \
    -treatment_directory /path/to/treatment_db
```

This will output a summary of the treatment candidates with their eligibility criteria, a list of recommended treatments, and whether SOC
has been exhausted. In the future, SOC recommendations will be incorporated into ACTIN reports.

### References

#### Disease Ontology ID (DOID)

For rules about e.g. primary tumor location and type, second primaries and 'other conditions', one or more DOIDs may be implemented. For
more information, see https://disease-ontology.org/.

#### CYP interactions

To evaluates rules about CYP interactions, we made use of the list of interactions on the following
website: https://www.fda.gov/drugs/drug-interactions-labeling/healthcare-professionals-fdas-examples-drugs-interact-cyp-enzymes-and-transporter-systems
.

#### QT prolongating drugs

To evaluate rules about QT prolongation, we made use of the list of drugs on the following website: https://crediblemeds.org/.

#### Anatomical Therapeutical Chemical codes (ATC codes)

To classify medication we made use of the ATC classification system: https://www.whocc.no/atc_ddd_index/. All active substances are
classified in a hierarchy with five different levels.

### Version History and Download Links

- Upcoming (first release) 